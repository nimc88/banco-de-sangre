<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bludee - Sistema de Banco de Sangre con IA</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 50%, #2563eb 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .filing-cabinet {
            max-width: 1200px;
            margin: 0 auto;
            background: linear-gradient(145deg, #f8fafc, #e2e8f0);
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
            border: 3px solid #cbd5e1;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: #1e40af;
        }

        .header h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #dc2626, #ef4444);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header .subtitle {
            font-size: 1.2rem;
            color: #64748b;
            font-weight: 500;
            margin-bottom: 15px;
        }

        .header .slogan {
            font-size: 1rem;
            color: #ef4444;
            font-style: italic;
            font-weight: 600;
        }

        .ai-badge {
            display: inline-block;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-top: 10px;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }

        .folders-container {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .folder {
            position: relative;
            margin-bottom: 20px;
        }

        .folder-tab {
            color: white;
            padding: 14px 30px;
            border-radius: 12px 12px 0 0;
            cursor: pointer;
            font-weight: 600;
            font-size: 1.1rem;
            box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-bottom: none;
            min-width: 280px;
            text-align: center;
        }

        .folder-tab.gestion-tab {
            background: linear-gradient(135deg, #dc2626, #ef4444);
        }

        .folder-tab.dashboard-tab {
            background: linear-gradient(135deg, #1e40af, #3b82f6);
        }

        .folder-tab.expedientes-tab {
            background: linear-gradient(135deg, #0891b2, #06b6d4);
        }

        .folder-tab.administracion-tab {
            background: linear-gradient(135deg, #ea580c, #f97316);
        }

        .folder-tab:hover {
            transform: translateY(-3px);
        }

        .folder-tab.active {
            transform: translateY(-2px);
        }

        .folder-tab::before {
            content: 'üìÅ';
            margin-right: 8px;
            font-size: 1.2rem;
        }

        .folder-content {
            background: white;
            border: 3px solid #e2e8f0;
            border-radius: 0 0 16px 16px;
            padding: 30px;
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
            display: none;
            min-height: 380px;
        }

        .folder-content.active {
            display: block;
        }

        .files-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 18px;
        }

        .file-item {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 25px 15px;
            text-decoration: none;
            color: #374151;
            transition: all 0.3s ease;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            cursor: pointer;
        }

        .file-item:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.15);
        }

        .file-icon {
            font-size: 2.8rem;
            margin-bottom: 12px;
            display: block;
        }

        .file-title {
            font-weight: 600;
            font-size: 1rem;
            color: #1f2937;
            line-height: 1.4;
        }

        .folder-stats {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            border: 2px solid #0ea5e9;
            border-radius: 8px;
            padding: 12px;
            margin-top: 25px;
            text-align: center;
            font-size: 0.9rem;
            color: #0c4a6e;
            font-weight: 500;
        }

        .system-info {
            text-align: center;
            margin-top: 30px;
            color: #64748b;
            font-size: 0.95rem;
            font-weight: 500;
        }

        /* Chatbot experto en banco de sangre */
        .bludee-assistant {
            position: fixed;
            bottom: 120px;
            right: 30px;
            width: 400px;
            height: 550px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.3);
            border: 3px solid #ef4444;
            z-index: 1000;
            transform: translateY(150%);
            transition: all 0.4s ease;
            display: flex;
            flex-direction: column;
        }

        .bludee-assistant.active {
            transform: translateY(0);
        }

        .bludee-assistant.minimized {
            height: 70px;
            width: 320px;
            transform: translateY(0);
        }

        .bludee-assistant.minimized .bludee-chat {
            display: none;
        }

        .bludee-header {
            background: linear-gradient(135deg, #dc2626, #ef4444);
            color: white;
            padding: 12px 20px;
            border-radius: 17px 17px 0 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .bludee-assistant.minimized .bludee-header {
            border-radius: 17px;
            padding: 15px 20px;
        }

        .bludee-assistant.minimized .bludee-header:hover {
            background: linear-gradient(135deg, #b91c1c, #dc2626);
        }

        .bludee-avatar {
            width: 45px;
            height: 45px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid rgba(255, 255, 255, 0.8);
            font-size: 20px;
            color: white;
            font-weight: bold;
            position: relative;
        }

        .ai-indicator {
            position: absolute;
            bottom: -2px;
            right: -2px;
            width: 14px;
            height: 14px;
            background: #10b981;
            border-radius: 50%;
            border: 2px solid white;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .bludee-info h3 {
            font-size: 1rem;
            margin-bottom: 2px;
        }

        .bludee-info p {
            font-size: 0.75rem;
            opacity: 0.9;
        }

        .bludee-assistant.minimized .bludee-info p {
            font-style: italic;
            opacity: 0.8;
        }

        .control-buttons {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .ai-status {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 3px 6px;
            border-radius: 10px;
            font-size: 0.6rem;
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .minimize-btn, .bludee-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 14px;
            cursor: pointer;
            padding: 6px 8px;
            border-radius: 6px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .minimize-btn:hover, .bludee-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .bludee-chat {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            background: #f8f9fa;
        }

        .message {
            margin-bottom: 12px;
            animation: messageSlide 0.3s ease;
        }

        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(15px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .bot-message {
            background: white;
            padding: 12px;
            border-radius: 12px 12px 12px 4px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-left: 3px solid #ef4444;
            max-width: 95%;
            line-height: 1.5;
            font-size: 0.85rem;
            position: relative;
        }

        .bot-message::before {
            content: 'ü©∏';
            position: absolute;
            top: -6px;
            left: -6px;
            background: #10b981;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            border: 2px solid white;
        }

        .user-message {
            background: linear-gradient(135deg, #dc2626, #ef4444);
            color: white;
            padding: 10px 12px;
            border-radius: 12px 12px 4px 12px;
            margin-left: auto;
            margin-right: 0;
            text-align: right;
            max-width: 80%;
            box-shadow: 0 2px 8px rgba(220, 38, 38, 0.3);
            font-size: 0.85rem;
        }

        .expert-tag {
            display: inline-block;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 0.65rem;
            margin-bottom: 6px;
            font-weight: 600;
        }

        .quick-options {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            margin-top: 8px;
        }

        .quick-btn {
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            color: #0c4a6e;
            padding: 6px 10px;
            border-radius: 15px;
            font-size: 0.7rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quick-btn:hover {
            background: #0ea5e9;
            color: white;
            transform: translateY(-1px);
        }

        .chat-input-container {
            padding: 15px;
            background: white;
            border-top: 2px solid #f1f5f9;
            flex-shrink: 0;
        }

        .chat-input-group {
            display: flex;
            gap: 8px;
            align-items: flex-end;
        }

        .chat-input {
            flex: 1;
            padding: 10px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 20px;
            font-size: 0.85rem;
            outline: none;
            transition: border-color 0.3s ease;
            resize: none;
            max-height: 80px;
            min-height: 38px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .chat-input:focus {
            border-color: #ef4444;
        }

        .send-btn {
            background: linear-gradient(135deg, #dc2626, #ef4444);
            color: white;
            border: none;
            width: 38px;
            height: 38px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .send-btn:hover:not(:disabled) {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.4);
        }

        .send-btn:disabled {
            background: #94a3b8;
            cursor: not-allowed;
            transform: none;
        }

        .bludee-toggle {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, #dc2626, #ef4444);
            border: 3px solid white;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(220, 38, 38, 0.4);
            transition: all 0.3s ease;
            z-index: 999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .bludee-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 10px 30px rgba(220, 38, 38, 0.5);
        }

        .bludee-toggle.hidden {
            transform: scale(0);
            opacity: 0;
        }

        .toggle-main {
            font-size: 24px;
            margin-bottom: 2px;
        }

        .toggle-ai {
            font-size: 8px;
            background: #10b981;
            padding: 1px 4px;
            border-radius: 6px;
        }

        .typing-indicator {
            display: none;
            align-items: center;
            gap: 5px;
            color: #64748b;
            font-style: italic;
            font-size: 0.75rem;
            padding: 8px 15px;
        }

        .typing-dots {
            display: flex;
            gap: 2px;
        }

        .typing-dot {
            width: 5px;
            height: 5px;
            background: #64748b;
            border-radius: 50%;
            animation: typingDot 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes typingDot {
            0%, 80%, 100% {
                transform: scale(0);
            }
            40% {
                transform: scale(1);
            }
        }

        @media (max-width: 768px) {
            .bludee-assistant {
                width: 95%;
                right: 2.5%;
                left: 2.5%;
                height: 70vh;
                bottom: 100px;
            }

            .bludee-assistant.minimized {
                height: 65px;
                width: 90%;
                right: 5%;
                left: 5%;
            }

            .bludee-toggle {
                width: 60px;
                height: 60px;
            }

            .toggle-main {
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="filing-cabinet">
        <div class="header">
            <h1>üóÉÔ∏è Bludee</h1>
            <p class="subtitle">Sistema de Gesti√≥n Hospitalaria de Componentes Sangu√≠neos</p>
            <p class="slogan">"Cada gota. Cada vida. Conectados."</p>
            <div class="ai-badge">ü©∏ Experto en Medicina Transfusional</div>
        </div>

        <div class="folders-container">
            <!-- Dashboard -->
            <div class="folder">
                <div class="folder-tab dashboard-tab active" onclick="toggleFolder(this, 'dashboard')">
                    Dashboard
                </div>
                <div class="folder-content dashboard active">
                    <div class="files-grid">
                        <div class="file-item" onclick="showModuleInfo('Panel de Control')">
                            <span class="file-icon">üìà</span>
                            <div class="file-title">Panel de Control</div>
                        </div>
                        <div class="file-item" onclick="showModuleInfo('Estad√≠sticas Generales')">
                            <span class="file-icon">üìä</span>
                            <div class="file-title">Estad√≠sticas Generales</div>
                        </div>
                        <div class="file-item" onclick="showModuleInfo('Actividad en Tiempo Real')">
                            <span class="file-icon">‚ö°</span>
                            <div class="file-title">Actividad en Tiempo Real</div>
                        </div>
                        <div class="file-item" onclick="showModuleInfo('Indicadores KPI')">
                            <span class="file-icon">üéØ</span>
                            <div class="file-title">Indicadores KPI</div>
                        </div>
                        <div class="file-item" onclick="showModuleInfo('Resumen Diario')">
                            <span class="file-icon">üìã</span>
                            <div class="file-title">Resumen Diario</div>
                        </div>
                    </div>
                    <div class="folder-stats">
                        üìä Vista general del sistema | ‚ö° Tiempo real | üéØ M√©tricas clave
                    </div>
                </div>
            </div>

            <!-- Gesti√≥n de Componentes -->
            <div class="folder">
                <div class="folder-tab gestion-tab" onclick="toggleFolder(this, 'gestion')">
                    Gesti√≥n de Componentes
                </div>
                <div class="folder-content gestion">
                    <div class="files-grid">
                        <div class="file-item" onclick="showModuleInfo('Registro de Unidad Recibida')">
                            <span class="file-icon">üì•</span>
                            <div class="file-title">Registro de Unidad Recibida</div>
                        </div>
                        <div class="file-item" onclick="showModuleInfo('Registro de Emergencia')">
                            <span class="file-icon">üö®</span>
                            <div class="file-title">Registro de Emergencia</div>
                        </div>
                        <div class="file-item" onclick="showModuleInfo('Despacho de Unidad')">
                            <span class="file-icon">üì§</span>
                            <div class="file-title">Despacho de Unidad</div>
                        </div>
                        <div class="file-item" onclick="showModuleInfo('Componentes Devueltos')">
                            <span class="file-icon">‚Ü©Ô∏è</span>
                            <div class="file-title">Componentes Devueltos</div>
                        </div>
                        <div class="file-item" onclick="showModuleInfo('Trazabilidad')">
                            <span class="file-icon">üîç</span>
                            <div class="file-title">Trazabilidad</div>
                        </div>
                    </div>
                    <div class="folder-stats">
                        üìä Unidades activas: 24 | Despachadas hoy: 8 | Mes actual: 156
                    </div>
                </div>
            </div>

            <!-- Expedientes y Seguimiento -->
            <div class="folder">
                <div class="folder-tab expedientes-tab" onclick="toggleFolder(this, 'expedientes')">
                    Expedientes y Seguimiento
                </div>
                <div class="folder-content expedientes">
                    <div class="files-grid">
                        <div class="file-item" onclick="showModuleInfo('Historial de Transfusi√≥n')">
                            <span class="file-icon">üìä</span>
                            <div class="file-title">Historial de Transfusi√≥n</div>
                        </div>
                        <div class="file-item" onclick="showModuleInfo('Expedientes Mensuales')">
                            <span class="file-icon">üìã</span>
                            <div class="file-title">Expedientes Mensuales</div>
                        </div>
                        <div class="file-item" onclick="showModuleInfo('Notas Cl√≠nicas Internas')">
                            <span class="file-icon">üìù</span>
                            <div class="file-title">Notas Cl√≠nicas Internas</div>
                        </div>
                        <div class="file-item" onclick="showModuleInfo('Auditor√≠a y Logs')">
                            <span class="file-icon">üîé</span>
                            <div class="file-title">Auditor√≠a y Logs</div>
                        </div>
                    </div>
                    <div class="folder-stats">
                        üìà Pacientes registrados: 1,247 | Expedientes activos: 89 | √öltimo backup: Hoy
                    </div>
                </div>
            </div>

            <!-- Accesos y Administraci√≥n -->
            <div class="folder">
                <div class="folder-tab administracion-tab" onclick="toggleFolder(this, 'administracion')">
                    Accesos y Administraci√≥n
                </div>
                <div class="folder-content administracion">
                    <div class="files-grid">
                        <div class="file-item" onclick="showModuleInfo('Usuarios')">
                            <span class="file-icon">üë§</span>
                            <div class="file-title">Usuarios</div>
                        </div>
                        <div class="file-item" onclick="showModuleInfo('Roles y Permisos')">
                            <span class="file-icon">üîê</span>
                            <div class="file-title">Roles y Permisos</div>
                        </div>
                        <div class="file-item" onclick="showModuleInfo('Credenciales de Acceso')">
                            <span class="file-icon">üîë</span>
                            <div class="file-title">Credenciales de Acceso</div>
                        </div>
                        <div class="file-item" onclick="showModuleInfo('Bit√°cora de Acceso')">
                            <span class="file-icon">üìñ</span>
                            <div class="file-title">Bit√°cora de Acceso</div>
                        </div>
                        <div class="file-item" onclick="showModuleInfo('Configuraci√≥n del Sistema')">
                            <span class="file-icon">‚öôÔ∏è</span>
                            <div class="file-title">Configuraci√≥n del Sistema</div>
                        </div>
                    </div>
                    <div class="folder-stats">
                        üë• Usuarios activos: 12 | Sesiones hoy: 34 | √öltimo acceso admin: 08:45 AM
                    </div>
                </div>
            </div>
        </div>

        <div class="system-info">
            <p>üîí Sistema Seguro | üÜî Usuario: Norma I. Medina | ‚è∞ √öltimo acceso: Hoy 09:15 AM</p>
        </div>
    </div>

    <!-- Bot√≥n flotante para abrir Bludee -->
    <button class="bludee-toggle" onclick="toggleBludee()">
        <div class="toggle-main">B</div>
        <div class="toggle-ai">IA</div>
    </button>
    
    <!-- Asistente Bludee - Experto en Banco de Sangre -->
    <div class="bludee-assistant" id="bludeeAssistant">
        <div class="bludee-header" onclick="headerClick()">
            <div class="bludee-avatar">
                B
                <div class="ai-indicator"></div>
            </div>
            <div class="bludee-info">
                <h3>Bludee IA</h3>
                <p id="assistantStatus">Experto en medicina transfusional</p>
            </div>
            <div class="control-buttons">
                <span class="ai-status">ü©∏ MT</span>
                <button class="minimize-btn" onclick="event.stopPropagation(); minimizeChat()" id="minimizeBtn" title="Minimizar">
                    ‚¨áÔ∏è
                </button>
                <button class="bludee-close" onclick="event.stopPropagation(); toggleBludee()" title="Cerrar">
                    ‚úï
                </button>
            </div>
        </div>
        
        <div class="bludee-chat" id="chatContainer">
            <div class="chat-messages" id="chatMessages">
                <!-- Los mensajes aparecer√°n aqu√≠ -->
            </div>
            
            <div class="typing-indicator" id="typingIndicator">
                <span>Analizando consulta m√©dica...</span>
                <div class="typing-dots">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            </div>
            
            <div class="chat-input-container">
                <div class="chat-input-group">
                    <textarea 
                        class="chat-input" 
                        id="chatInput" 
                        placeholder="Consulta sobre banco de sangre, cruces, anticuerpos..."
                        rows="1"
                        onkeypress="handleEnterKey(event)"
                        oninput="autoResize(this)">
                    </textarea>
                    <button class="send-btn" onclick="sendMessage()" id="sendBtn" title="Enviar">
                        ‚û§
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let isAssistantOpen = false;
        let isMinimized = false;
        let chatInitialized = false;
        let conversationHistory = [];

        // BASE DE CONOCIMIENTO COMPLETA - EXPERTO EN BANCO DE SANGRE
        const bloodBankKnowledge = {
            // ANTICUERPOS ESPEC√çFICOS
            anticuerpos: {
                'anti-k': `**Anti-K (Sistema Kell)**

üß¨ **Caracter√≠sticas fundamentales:**
‚Ä¢ **Ant√≠geno:** K1 (KEL1), frecuencia 9% cauc√°sicos, <1% africanos
‚Ä¢ **Herencia:** Codominante, gen KEL en cromosoma 7
‚Ä¢ **Tipo:** IgG, reactivo 37¬∞C y AGH
‚Ä¢ **Significancia:** ALTA - puede causar reacciones graves

‚ö†Ô∏è **Importancia cl√≠nica:**
‚Ä¢ **Reacciones hemol√≠ticas:** Agudas y tard√≠as severas
‚Ä¢ **EHRN:** Moderada a severa
‚Ä¢ **Supervivencia:** Reducida significativamente
‚Ä¢ **Detecci√≥n:** Obligatoria en screening

üî¨ **Manejo transfusional:**
‚Ä¢ **Fenotipado:** Siempre K negativo
‚Ä¢ **Crossmatch:** Compatible obligatorio
‚Ä¢ **Inventario:** Mantener stock K- disponible
‚Ä¢ **Documentaci√≥n:** Historia permanente

üìã **Protocolo anti-K:**
1. Panel de identificaci√≥n 11-16 c√©lulas
2. Confirmar especificidad con c√©lulas K+
3. Descartar otros anticuerpos
4. Proveer solo sangre K negativa
5. Monitoreo post-transfusional`,

                'anti-d': `**Anti-D (Sistema Rh)**

üß¨ **Caracter√≠sticas:**
‚Ä¢ **Ant√≠geno:** RhD, frecuencia 85% positivos
‚Ä¢ **Herencia:** Autos√≥mica dominante
‚Ä¢ **Tipo:** IgG predominante, algunos IgM
‚Ä¢ **Significancia:** MUY ALTA

‚ö†Ô∏è **Importancia cl√≠nica:**
‚Ä¢ **Reacciones:** Hem√≥lisis intravascular severa
‚Ä¢ **EHRN:** Causa principal hist√≥ricamente
‚Ä¢ **Inmunizaci√≥n:** 50-70% personas Rh- expuestas
‚Ä¢ **Prevenci√≥n:** RhoGAM profil√°ctico

ü§± **Manejo en embarazo:**
‚Ä¢ **Screening:** Todas las embarazadas
‚Ä¢ **Titulaci√≥n:** Seguimiento seriado
‚Ä¢ **Doppler:** Monitoreo fetal si t√≠tulo >16
‚Ä¢ **RhoGAM:** 28 semanas y posparto

üìä **Interpretaci√≥n t√≠tulos:**
‚Ä¢ **<16:** Seguimiento rutinario
‚Ä¢ **16-32:** Vigilancia aumentada
‚Ä¢ **>32:** Referir medicina materno-fetal
‚Ä¢ **>64:** Monitoreo intensivo`,

                'anti-e': `**Anti-E (Sistema Rh)**

üß¨ **Caracter√≠sticas:**
‚Ä¢ **Ant√≠geno:** RhE, frecuencia 30% poblaci√≥n
‚Ä¢ **Herencia:** Ligado a RhC/c y RhD
‚Ä¢ **Tipo:** IgG, reactivo AGH
‚Ä¢ **Significancia:** Moderada a alta

‚ö†Ô∏è **Importancia cl√≠nica:**
‚Ä¢ **Reacciones:** Hem√≥lisis retardada principalmente
‚Ä¢ **EHRN:** Leve a moderada
‚Ä¢ **Frecuencia:** 2-5% anticuerpos irregulares
‚Ä¢ **Detecci√≥n:** Screening rutinario

üî¨ **Manejo:**
‚Ä¢ **Fenotipado:** E negativo obligatorio
‚Ä¢ **Crossmatch:** Compatible
‚Ä¢ **Seguimiento:** Monitoreo t√≠tulos
‚Ä¢ **Embarazo:** Evaluaci√≥n fetal si presente`,

                'anti-c': `**Anti-c (Sistema Rh)**

üß¨ **Caracter√≠sticas:**
‚Ä¢ **Ant√≠geno:** Rhc, frecuencia 80% poblaci√≥n
‚Ä¢ **Herencia:** Al√©lico con RhC
‚Ä¢ **Tipo:** IgG, AGH reactivo
‚Ä¢ **Significancia:** Moderada

‚ö†Ô∏è **Importancia cl√≠nica:**
‚Ä¢ **Reacciones:** Hem√≥lisis tard√≠a
‚Ä¢ **EHRN:** Leve a moderada
‚Ä¢ **Compatibilidad:** c negativo necesario
‚Ä¢ **Detecci√≥n:** Panel rutinario

üî¨ **Consideraciones:**
‚Ä¢ **Alotipificaci√≥n:** c negativo para transfundir
‚Ä¢ **Embarazo:** Monitoreo si presente
‚Ä¢ **Crossmatch:** Siempre compatible
‚Ä¢ **Documentaci√≥n:** Historia transfusional`
            },

            // PRUEBAS DE LABORATORIO
            pruebas: {
                'crossmatch': `**Pruebas de Compatibilidad (Crossmatch)**

üî¨ **Tipos de crossmatch:**

**1. CROSSMATCH MAYOR:**
‚Ä¢ **Qu√© es:** Suero paciente + GR donante
‚Ä¢ **Detecta:** Anticuerpos en paciente vs ant√≠genos donante
‚Ä¢ **Fases:** Salina, 37¬∞C, AGH
‚Ä¢ **Importancia:** Previene reacciones hemol√≠ticas

**2. CROSSMATCH MENOR:**
‚Ä¢ **Qu√© es:** Plasma donante + GR paciente
‚Ä¢ **Detecta:** Anticuerpos en donante vs ant√≠genos paciente
‚Ä¢ **Uso:** Limitado, transfusiones masivas
‚Ä¢ **Menos cr√≠tico:** Diluci√≥n in vivo

**3. CROSSMATCH ABREVIADO:**
‚Ä¢ **Cu√°ndo:** Paciente sin anticuerpos irregulares
‚Ä¢ **Procedimiento:** Solo fase AGH
‚Ä¢ **Tiempo:** 5-10 minutos
‚Ä¢ **Emergencias:** Protocolo acelerado

üìã **Interpretaci√≥n resultados:**
‚Ä¢ **Grado 4+:** Incompatibilidad absoluta
‚Ä¢ **Grado 3+:** Incompatible, buscar causa
‚Ä¢ **Grado 2+:** Incompatible, investigar
‚Ä¢ **Grado 1+:** D√©bil, evaluar significancia
‚Ä¢ **Negativo:** Compatible para transfundir

‚ö†Ô∏è **Crossmatch incompatible:**
1. **Verificar:** Muestras e identidad
2. **Repetir:** Tipificaci√≥n ABO/Rh
3. **Panel:** Identificaci√≥n anticuerpos
4. **DAT:** Descartar autoanticuerpos
5. **Buscar:** Unidades compatibles`,

                'panel_anticuerpos': `**Panel de Identificaci√≥n de Anticuerpos**

üî¨ **Estructura del panel:**
‚Ä¢ **C√©lulas:** 11-16 gl√≥bulos rojos O diferentes
‚Ä¢ **Ant√≠genos:** 20+ sistemas sangu√≠neos
‚Ä¢ **Fases:** Salina, 37¬∞C, AGH
‚Ä¢ **Controles:** Autocontrol inclu√≠do

üìä **Sistemas incluidos:**
‚Ä¢ **Rh:** D, C, E, c, e
‚Ä¢ **Kell:** K, k, Kpa, Kpb, Jsa, Jsb
‚Ä¢ **Duffy:** Fya, Fyb
‚Ä¢ **Kidd:** Jka, Jkb
‚Ä¢ **MNS:** M, N, S, s
‚Ä¢ **Lutheran:** Lua, Lub
‚Ä¢ **Diego:** Dia, Dib
‚Ä¢ **Otros:** Lea, Leb, P1, etc.

üîç **Proceso de identificaci√≥n:**
1. **Patr√≥n reactividad:** Comparar con panel
2. **Regla de los tres:** M√≠nimo 3 c√©lulas positivas
3. **Exclusi√≥n:** Ant√≠genos en c√©lulas negativas
4. **Dosis:** Homocigotos vs heterocigotos
5. **Confirmaci√≥n:** C√©lulas espec√≠ficas

üìã **Interpretaci√≥n:**
‚Ä¢ **Patr√≥n claro:** Anticuerpo espec√≠fico identificado
‚Ä¢ **Patr√≥n mixto:** M√∫ltiples anticuerpos
‚Ä¢ **No espec√≠fico:** Requiere estudios adicionales
‚Ä¢ **Autoreactividad:** DAT positivo`,

                'dat_completo': `**DAT (Direct Antiglobulin Test) Completo**

üî¨ **Procedimiento DAT:**
‚Ä¢ **Lavado:** 3-4 veces con salina fisiol√≥gica
‚Ä¢ **AGH poliespec√≠fico:** Anti-IgG + Anti-C3d
‚Ä¢ **Incubaci√≥n:** 15-30 segundos
‚Ä¢ **Centrifugaci√≥n:** 1000 rpm, 15 segundos
‚Ä¢ **Lectura:** Aglutinaci√≥n macro y microsc√≥pica

üìä **Tipos de AGH:**
‚Ä¢ **Poliespec√≠fico:** IgG + C3d combinado
‚Ä¢ **Monoespec√≠fico IgG:** Solo inmunoglobulina G
‚Ä¢ **Monoespec√≠fico C3d:** Solo complemento
‚Ä¢ **IgA, IgM:** Para casos especiales

üîç **Interpretaci√≥n por patr√≥n:**
‚Ä¢ **IgG+ C3d-:** Anticuerpos "calientes" (AHAI caliente)
‚Ä¢ **IgG- C3d+:** Anticuerpos "fr√≠os" o medicamentos
‚Ä¢ **IgG+ C3d+:** Patr√≥n mixto, AHAI severa
‚Ä¢ **IgG- C3d-:** Negativo normal

‚ö†Ô∏è **DAT positivo - Causas:**
‚Ä¢ **Autoinmune:** AHAI primaria o secundaria
‚Ä¢ **Aloanticuerpos:** Post-transfusional, EHRN
‚Ä¢ **Medicamentos:** Penicilina, cefalosporinas, quinidina
‚Ä¢ **Infecciones:** Mycoplasma, mononucleosis
‚Ä¢ **Enfermedades:** LES, LLC, linfomas

üìã **Algoritmo DAT positivo:**
1. **Confirmar** positividad
2. **Elu√≠do** para identificar especificidad
3. **Historia cl√≠nica** medicamentos/transfusiones
4. **Laboratorios** hem√≥lisis (LDH, bilirrubina)
5. **Manejo** seg√∫n causa identificada`,

                'eluido': `**Elu√≠do - Identificaci√≥n de Anticuerpos**

üî¨ **¬øQu√© es el elu√≠do?**
‚Ä¢ **Proceso:** Separar anticuerpos adheridos a GR
‚Ä¢ **Objetivo:** Identificar especificidad anticuerpos
‚Ä¢ **Indicaci√≥n:** DAT positivo por IgG
‚Ä¢ **M√©todos:** Calor, √°cido, √©ter

üß™ **M√©todos de eluci√≥n:**
‚Ä¢ **M√©todo calor:** 56¬∞C por 10 minutos
‚Ä¢ **M√©todo √°cido:** pH bajo (glycine-HCl)
‚Ä¢ **M√©todo √©ter:** Disolvente org√°nico
‚Ä¢ **Freeze-thaw:** Congelaci√≥n-descongelaci√≥n

üìä **Interpretaci√≥n:**
‚Ä¢ **Patr√≥n espec√≠fico:** Anti-D, -E, -K, etc.
‚Ä¢ **Patr√≥n panreactivo:** Autoanticuerpo
‚Ä¢ **Negativo:** No se recuperan anticuerpos
‚Ä¢ **Mixto:** M√∫ltiples especificidades

‚ö†Ô∏è **Elu√≠do espec√≠fico:**
‚Ä¢ **Anti-D:** EHRN, transfusi√≥n incompatible
‚Ä¢ **Anti-E, -c:** Reacciones tard√≠as
‚Ä¢ **Anti-K:** Reacciones severas
‚Ä¢ **Especificidad m√∫ltiple:** Aloinmunizaci√≥n compleja

üìã **Protocolo elu√≠do:**
1. **Lavado** c√©lulas DAT positivas
2. **Eluci√≥n** m√©todo elegido
3. **Neutralizaci√≥n** pH si √°cido
4. **Prueba** vs panel identificaci√≥n
5. **Interpretaci√≥n** patr√≥n reactividad`
            },

            // GEN√âTICA Y HERENCIA
            genetica: {
                'herencia_abo': `**Gen√©tica del Sistema ABO**

üß¨ **Bases gen√©ticas:**
‚Ä¢ **Locus:** Cromosoma 9q34
‚Ä¢ **Alelos:** A¬π, A¬≤, B, O (alelo nulo)
‚Ä¢ **Herencia:** Codominante A y B, O recesivo
‚Ä¢ **Productos:** Transferasas A y B

üë®‚Äçüë©‚Äçüëß‚Äçüë¶ **Predicci√≥n gen√©tica:**

**Padres A x B:**
‚Ä¢ **Posible:** AB (25%), A (25%), B (25%), O (25%)
‚Ä¢ **Nota:** Solo si ambos AO y BO

**Padres AB x O:**
‚Ä¢ **Resultado:** 50% A (AO), 50% B (BO)
‚Ä¢ **Imposible:** AB u O

**Padres O x O:**
‚Ä¢ **Resultado:** 100% O (OO)
‚Ä¢ **Imposible:** A, B, o AB

üìä **Casos de exclusi√≥n:**
‚Ä¢ **Padres O + hijo AB:** Imposible gen√©ticamente
‚Ä¢ **Padres AB + hijo O:** Imposible gen√©ticamente
‚Ä¢ **Un padre AB + hijo O:** Exclusi√≥n paternidad

üî¨ **Subgrupos A:**
‚Ä¢ **A1:** 80% poblaci√≥n A, reacciona fuerte
‚Ä¢ **A2:** 20% poblaci√≥n A, reacciona d√©bil
‚Ä¢ **A3, Ax, Ael:** Variantes raras
‚Ä¢ **Anti-A1:** Presente en algunos A2`,

                'herencia_rh': `**Gen√©tica del Sistema Rh**

üß¨ **Estructura gen√©tica:**
‚Ä¢ **Genes:** RHD y RHCE en cromosoma 1p36
‚Ä¢ **RHD:** Codifica ant√≠geno D
‚Ä¢ **RHCE:** Codifica C/c y E/e
‚Ä¢ **Herencia:** Ligada, haplotipos heredados juntos

üìä **Haplotipos comunes:**
‚Ä¢ **DCe** (R1): 42% cauc√°sicos
‚Ä¢ **DcE** (R2): 14% cauc√°sicos  
‚Ä¢ **Dce** (R0): 4% cauc√°sicos, 44% africanos
‚Ä¢ **dce** (r): 37% cauc√°sicos
‚Ä¢ **dCe** (r'): 2% cauc√°sicos
‚Ä¢ **dcE** (r''): 1% cauc√°sicos

üë®‚Äçüë©‚Äçüëß‚Äçüë¶ **Predicci√≥n Rh:**

**Padre DCe/dce x Madre dce/dce:**
‚Ä¢ **50% DCe/dce:** Rh positivo (R1r)
‚Ä¢ **50% dce/dce:** Rh negativo (rr)

**Padre DCe/DcE x Madre dce/dce:**
‚Ä¢ **25% DCe/dce:** R1r
‚Ä¢ **25% DcE/dce:** R2r
‚Ä¢ **25% Dce/dce:** R0r
‚Ä¢ **25% dce/dce:** rr

ü§± **Aplicaci√≥n cl√≠nica:**
‚Ä¢ **Riesgo EHRN:** Predecir seg√∫n genotipos paternos
‚Ä¢ **Probabilidad D+:** Calcular seg√∫n haplotipos
‚Ä¢ **Consejer√≠a:** Informar riesgos futuros embarazos`,

                'calculo_bebe': `**C√°lculo Grupo Sangu√≠neo del Beb√©**

üßÆ **Herramientas de predicci√≥n:**

**SISTEMA ABO:**
üìä **Tabla de probabilidades:**

| Madre | Padre | A    | B    | AB   | O    |
|-------|-------|------|------|------|------|
| A     | A     | 75%  | 0%   | 0%   | 25%  |
| A     | B     | 25%  | 25%  | 25%  | 25%  |
| A     | AB    | 50%  | 0%   | 50%  | 0%   |
| A     | O     | 50%  | 0%   | 0%   | 50%  |
| B     | B     | 0%   | 75%  | 0%   | 25%  |
| AB    | AB    | 25%  | 25%  | 50%  | 0%   |
| O     | O     | 0%   | 0%   | 0%   | 100% |

**SISTEMA RH:**
‚Ä¢ **D+ x D+:** 75-100% D+ (seg√∫n genotipo)
‚Ä¢ **D+ x D-:** 0-100% D+ (seg√∫n genotipo padre)
‚Ä¢ **D- x D-:** 100% D- (siempre)

üî¨ **Ejemplo de c√°lculo:**
**Madre A Rh+ (AO, DCe/dce) x Padre B Rh- (BO, dce/dce):**

**ABO:** 25% AB, 25% A, 25% B, 25% O
**Rh:** 50% positivo, 50% negativo

**Combinaciones posibles:**
‚Ä¢ 12.5% AB Rh+
‚Ä¢ 12.5% AB Rh-
‚Ä¢ 12.5% A Rh+
‚Ä¢ 12.5% A Rh-
‚Ä¢ 12.5% B Rh+
‚Ä¢ 12.5% B Rh-
‚Ä¢ 12.5% O Rh+
‚Ä¢ 12.5% O Rh-

‚ö†Ô∏è **Limitaciones:**
‚Ä¢ **Genotipos exactos:** Necesarios para precisi√≥n
‚Ä¢ **Variantes raras:** No consideradas en c√°lculos b√°sicos
‚Ä¢ **Mutaciones:** Eventos excepcionales posibles`
            },

            // PROTOCOLOS CL√çNICOS
            protocolos: {
                'emergencia_masiva': `**Protocolo de Transfusi√≥n Masiva**

üö® **Activaci√≥n C√≥digo Rojo:**
‚Ä¢ **Criterios:** >4U en 1h, >10U en 24h, >30% volemia
‚Ä¢ **Equipo:** Cirujano, anestesi√≥logo, banco de sangre
‚Ä¢ **Comunicaci√≥n:** Activaci√≥n inmediata 24/7

‚ö° **Respuesta <10 minutos:**
‚Ä¢ **6 unidades GR O-** (universal)
‚Ä¢ **6 unidades PFC AB** (universal)
‚Ä¢ **1 pool plaquetas** grupo espec√≠fico
‚Ä¢ **Crioprecipitado** disponible

ü©∏ **Ratio 1:1:1:**
‚Ä¢ **GR:PFC:Plaquetas** en proporci√≥n balanceada
‚Ä¢ **Previene:** Coagulopat√≠a dilucional
‚Ä¢ **Mantiene:** Factores coagulaci√≥n
‚Ä¢ **Objetivo:** Hemostasia efectiva

üìä **Laboratorios STAT:**
‚Ä¢ **Tipificaci√≥n:** ABO/Rh inmediato
‚Ä¢ **Crossmatch:** Abreviado si necesario
‚Ä¢ **Hemograma:** Hb, plaquetas
‚Ä¢ **Coagulaci√≥n:** PT, PTT, fibrin√≥geno
‚Ä¢ **Qu√≠mica:** Calcio, potasio, lactato

üéØ **Objetivos terap√©uticos:**
‚Ä¢ **Hematocrito:** >21%
‚Ä¢ **Plaquetas:** >50,000/ŒºL
‚Ä¢ **Fibrin√≥geno:** >100-150 mg/dL
‚Ä¢ **PT/PTT:** <1.5x control
‚Ä¢ **Calcio:** >1.0 mmol/L

‚ö†Ô∏è **Complicaciones vigilar:**
‚Ä¢ **Hipotermia:** <35¬∞C
‚Ä¢ **Acidosis:** pH <7.2
‚Ä¢ **Hipocalcemia:** Citrato toxicidad
‚Ä¢ **Hiperpotasemia:** GR almacenados
‚Ä¢ **TACO:** Sobrecarga circulatoria

üìã **Protocolo por fases:**
**Fase 1 (0-30 min):**
‚Ä¢ O- universal mientras tipificaci√≥n
‚Ä¢ Ratio 1:1:1 estricto
‚Ä¢ Laboratorios cada 30 min

**Fase 2 (30-60 min):**
‚Ä¢ Productos tipo espec√≠fico
‚Ä¢ Ajustar seg√∫n laboratorios
‚Ä¢ Monitoreo continuo

**Fase 3 (>60 min):**
‚Ä¢ Productos compatibles
‚Ä¢ Terapia dirigida por labs
‚Ä¢ Evaluar hemostasia`,

                'reacciones_transfusionales': `**Manejo de Reacciones Transfusionales**

üö® **Protocolo de emergencia:**
1. **DETENER** transfusi√≥n inmediatamente
2. **Mantener** v√≠a venosa con salina
3. **Evaluar** signos vitales
4. **Notificar** m√©dico tratante
5. **Enviar** muestras al banco

üìä **Clasificaci√≥n por severidad:**

**LEVES:**
‚Ä¢ Fiebre <1¬∞C
‚Ä¢ Urticaria localizada
‚Ä¢ Prurito leve
‚Ä¢ **Manejo:** Sintom√°tico, observaci√≥n

**MODERADAS:**
‚Ä¢ Fiebre >1¬∞C
‚Ä¢ Urticaria generalizada
‚Ä¢ Hipotensi√≥n leve
‚Ä¢ **Manejo:** Antihistam√≠nicos, corticoides

**SEVERAS:**
‚Ä¢ Hipotensi√≥n severa
‚Ä¢ Disnea, broncoespasmo
‚Ä¢ Hemoglobinuria
‚Ä¢ **Manejo:** Soporte vital, epinefrina

‚ö†Ô∏è **Reacci√≥n hemol√≠tica aguda:**
‚Ä¢ **S√≠ntomas:** Dolor lumbar, fiebre alta, hemoglobinuria
‚Ä¢ **Laboratorio:** Hem√≥lisis, LDH elevada, haptoglobina baja
‚Ä¢ **Tratamiento:** Fluidos, diuresis, soporte renal
‚Ä¢ **Investigaci√≥n:** Error ABO, anticuerpos

üî¨ **Investigaci√≥n post-reacci√≥n:**
1. **Verificar** identidad paciente-unidad
2. **Cultivos** si sospecha bacteriana
3. **DAT** y muestra post-transfusional
4. **Repetir** tipificaci√≥n y crossmatch
5. **Buscar** nuevos anticuerpos

üìã **Prevenci√≥n reacciones:**
‚Ä¢ **Premedicaci√≥n:** Pacientes con historia
‚Ä¢ **Leucorreducci√≥n:** Productos filtrados
‚Ä¢ **Calentamiento:** Evitar hipotermia
‚Ä¢ **Velocidad adecuada:** Seg√∫n tolerancia`,

                'protocolos_especiales': `**Productos Sangu√≠neos Especiales**

ü©∏ **SANGRE IRRADIADA:**
‚Ä¢ **Dosis:** 25 Gy gamma irradiaci√≥n
‚Ä¢ **Objetivo:** Inactivar linfocitos T
‚Ä¢ **Previene:** TA-GVHD (enfermedad injerto vs hu√©sped)
‚Ä¢ **Vida √∫til:** Reducida a 28 d√≠as

**Indicaciones absolutas:**
‚Ä¢ Inmunodeficiencias cong√©nitas
‚Ä¢ Trasplante m√©dula √≥sea
‚Ä¢ Prematuros <1200g
‚Ä¢ Transfusiones intrauterinas
‚Ä¢ Productos HLA compatibles

**Indicaciones relativas:**
‚Ä¢ Transfusiones de familiares
‚Ä¢ Quimioterapia intensiva
‚Ä¢ Trasplante √≥rganos s√≥lidos

üßº **COMPONENTES LAVADOS:**
‚Ä¢ **Proceso:** 3 lavados con salina
‚Ä¢ **Remueve:** Plasma, prote√≠nas, anticuerpos
‚Ä¢ **Indicaciones:** Reacciones al√©rgicas severas
‚Ä¢ **Vida √∫til:** 24 horas post-lavado

ü¶† **PRODUCTOS CMV NEGATIVOS:**
‚Ä¢ **Pacientes:** Inmunocomprometidos CMV-
‚Ä¢ **Embarazadas:** CMV negativas
‚Ä¢ **Prematuros:** <1200g de madres CMV-
‚Ä¢ **Alternativa:** Leucorreducci√≥n

‚ùÑÔ∏è **PRODUCTOS CONGELADOS:**
‚Ä¢ **Plasma fresco:** -18¬∞C hasta 1 a√±o
‚Ä¢ **Crioprecipitado:** -18¬∞C hasta 1 a√±o
‚Ä¢ **Gl√≥bulos rojos:** Glicerol -80¬∞C hasta 10 a√±os
‚Ä¢ **Descongelaci√≥n:** Procedimientos espec√≠ficos`
            }
        };

        // FUNCI√ìN DE IA EXPERTA EN BANCO DE SANGRE
        function generateBloodBankResponse(question) {
            const q = question.toLowerCase().trim();
            
            // 1. ANTICUERPOS ESPEC√çFICOS
            if (q.includes('anti-k') || q.includes('antik') || q.includes('kell')) {
                return formatResponse('Anticuerpos', bloodBankKnowledge.anticuerpos['anti-k']);
            }
            
            if (q.includes('anti-d') || q.includes('antid') || (q.includes('rh') && q.includes('d'))) {
                return formatResponse('Anticuerpos', bloodBankKnowledge.anticuerpos['anti-d']);
            }
            
            if (q.includes('anti-e') || q.includes('antie')) {
                return formatResponse('Anticuerpos', bloodBankKnowledge.anticuerpos['anti-e']);
            }
            
            if (q.includes('anti-c') || q.includes('antic') || q.includes('rh c')) {
                return formatResponse('Anticuerpos', bloodBankKnowledge.anticuerpos['anti-c']);
            }
            
            // 2. PRUEBAS DE LABORATORIO
            if (q.includes('crossmatch') || q.includes('cruces') || q.includes('compatibilidad') || q.includes('cross match')) {
                return formatResponse('Crossmatch', bloodBankKnowledge.pruebas['crossmatch']);
            }
            
            if (q.includes('panel') || q.includes('identificacion') || q.includes('anticuerpos irregulares')) {
                return formatResponse('Panel', bloodBankKnowledge.pruebas['panel_anticuerpos']);
            }
            
            if (q.includes('dat') || q.includes('antiglobulina directa') || q.includes('coombs directa')) {
                return formatResponse('DAT', bloodBankKnowledge.pruebas['dat_completo']);
            }
            
            if (q.includes('eluido') || q.includes('elusion') || q.includes('eluir')) {
                return formatResponse('Elu√≠do', bloodBankKnowledge.pruebas['eluido']);
            }
            
            // 3. GEN√âTICA Y HERENCIA
            if ((q.includes('genetica') || q.includes('herencia') || q.includes('hereditario')) && q.includes('abo')) {
                return formatResponse('Gen√©tica ABO', bloodBankKnowledge.genetica['herencia_abo']);
            }
            
            if ((q.includes('genetica') || q.includes('herencia')) && q.includes('rh')) {
                return formatResponse('Gen√©tica Rh', bloodBankKnowledge.genetica['herencia_rh']);
            }
            
            if (q.includes('bebe') || q.includes('hijo') || q.includes('ni√±o') || 
                (q.includes('mama') && q.includes('papa')) || q.includes('padres')) {
                return formatResponse('C√°lculo Beb√©', bloodBankKnowledge.genetica['calculo_bebe']);
            }
            
            // 4. PROTOCOLOS CL√çNICOS
            if (q.includes('emergencia') || q.includes('masiva') || q.includes('codigo rojo') || q.includes('trauma')) {
                return formatResponse('Emergencia', bloodBankKnowledge.protocolos['emergencia_masiva']);
            }
            
            if (q.includes('reaccion') || q.includes('reacciones') || q.includes('transfusional')) {
                return formatResponse('Reacciones', bloodBankKnowledge.protocolos['reacciones_transfusionales']);
            }
            
            if (q.includes('irradiada') || q.includes('lavado') || q.includes('cmv') || q.includes('especiales')) {
                return formatResponse('Productos Especiales', bloodBankKnowledge.protocolos['protocolos_especiales']);
            }
            
            // 5. RESPUESTAS CONTEXTUALES PARA BANCO DE SANGRE
            if (q.includes('hola') || q.includes('buenas') || q.includes('saludos')) {
                return formatResponse('Saludo', generateGreeting());
            }
            
            if (q.includes('ayuda') || q.includes('que puedes') || q.includes('como funciona')) {
                return formatResponse('Ayuda', generateHelpResponse());
            }
            
            // 6. TEMAS RELACIONADOS CON BANCO DE SANGRE
            if (q.includes('grupo') || q.includes('tipo') || q.includes('abo') || q.includes('tipificacion')) {
                return formatResponse('Tipificaci√≥n', generateABOResponse(q));
            }
            
            if (q.includes('rh') || q.includes('rhesus') || q.includes('positivo') || q.includes('negativo')) {
                return formatResponse('Sistema Rh', generateRhResponse(q));
            }
            
            if (q.includes('embarazo') || q.includes('embarazada') || q.includes('gestante') || q.includes('prenatal')) {
                return formatResponse('Embarazo', generatePregnancyResponse(q));
            }
            
            if (q.includes('transfusion') || q.includes('transfundir') || q.includes('administrar')) {
                return formatResponse('Transfusi√≥n', generateTransfusionResponse(q));
            }
            
            // 7. RESPUESTA INTELIGENTE POR DEFECTO
            return formatResponse('Consulta', generateIntelligentBloodBankResponse(q));
        }
        
        function generateGreeting() {
            return `¬°Hola! Soy **Bludee IA**, tu experto especializado en medicina transfusional. ü©∏ü§ñ

**Mi especialidad es banco de sangre completo:**

üî¨ **Anticuerpos:** Anti-K, Anti-D, Anti-E, Anti-c y m√°s
üß™ **Pruebas:** Crossmatch, panel de anticuerpos, DAT, elu√≠do
üß¨ **Gen√©tica:** Herencia ABO/Rh, c√°lculos padre-madre-beb√©
üö® **Protocolos:** Emergencias, reacciones, productos especiales
ü§± **Embarazo:** Seguimiento anti-D, EHRN, monitoreo fetal

**¬øEn qu√© puedo ayudarte hoy?** Preg√∫ntame cualquier cosa sobre banco de sangre, por compleja que sea.`;
        }
        
        function generateHelpResponse() {
            return `**¬øQu√© puedo hacer por ti?** ü©∏

Como experto en medicina transfusional, puedo ayudarte con:

üî¨ **ANTICUERPOS:**
‚Ä¢ Identificaci√≥n y significancia cl√≠nica
‚Ä¢ Manejo transfusional espec√≠fico
‚Ä¢ Protocolos seg√∫n especificidad

üß™ **PRUEBAS DE LABORATORIO:**
‚Ä¢ Crossmatch y compatibilidad
‚Ä¢ Panel de identificaci√≥n de anticuerpos
‚Ä¢ DAT y elu√≠do - interpretaci√≥n completa

üß¨ **GEN√âTICA DE GRUPOS SANGU√çNEOS:**
‚Ä¢ Herencia ABO y Rh
‚Ä¢ C√°lculos probabil√≠sticos padre-madre-beb√©
‚Ä¢ Predicciones gen√©ticas

üö® **PROTOCOLOS CL√çNICOS:**
‚Ä¢ Transfusi√≥n masiva y emergencias
‚Ä¢ Manejo de reacciones transfusionales
‚Ä¢ Productos especiales (irradiados, lavados)

ü§± **MEDICINA TRANSFUSIONAL EN EMBARAZO:**
‚Ä¢ Seguimiento anti-D y otros anticuerpos
‚Ä¢ EHRN - enfermedad hemol√≠tica del RN
‚Ä¢ Protocolos obst√©tricos

**¬°Preg√∫ntame lo que quieras!** Desde casos b√°sicos hasta los m√°s complejos.`;
        }
        
        function generateABOResponse(question) {
            return `**Sistema ABO - Fundamentos**

ü©∏ **Grupos sangu√≠neos ABO:**
‚Ä¢ **Grupo A:** Ant√≠geno A, anticuerpo anti-B
‚Ä¢ **Grupo B:** Ant√≠geno B, anticuerpo anti-A  
‚Ä¢ **Grupo AB:** Ant√≠genos A y B, sin anticuerpos
‚Ä¢ **Grupo O:** Sin ant√≠genos, anticuerpos anti-A y anti-B

üß¨ **Base gen√©tica:**
‚Ä¢ **Genes:** A, B (codominantes), O (recesivo)
‚Ä¢ **Locus:** Cromosoma 9
‚Ä¢ **Transferasas:** A y B modifican ant√≠geno H

üî¨ **Tipificaci√≥n ABO:**
‚Ä¢ **Prueba directa:** Suero anti-A, anti-B vs GR paciente
‚Ä¢ **Prueba reversa:** Suero paciente vs c√©lulas A1, B
‚Ä¢ **Concordancia:** Obligatoria entre directa y reversa

‚ö†Ô∏è **Discrepancias ABO:**
‚Ä¢ **Subgrupos A:** A2 puede reaccionar d√©bil
‚Ä¢ **Anticuerpos d√©biles:** Ancianos, inmunosuprimidos
‚Ä¢ **Prote√≠nas an√≥malas:** Hipergammaglobulinemia
‚Ä¢ **Quimerismo:** Post-trasplante

¬øTienes alguna pregunta espec√≠fica sobre tipificaci√≥n ABO?`;
        }
        
        function generateRhResponse(question) {
            return `**Sistema Rh - Informaci√≥n Completa**

üß¨ **Ant√≠genos principales:**
‚Ä¢ **D:** M√°s importante, 85% poblaci√≥n positiva
‚Ä¢ **C, E, c, e:** Ant√≠genos secundarios
‚Ä¢ **Herencia:** Compleja, haplotipos DCe, DcE, etc.

üî¨ **Tipificaci√≥n Rh:**
‚Ä¢ **Anti-D:** Obligatorio en toda tipificaci√≥n
‚Ä¢ **Du d√©bil:** Requiere AGH para detecci√≥n
‚Ä¢ **Control Rh:** Descartar autoaglutinaci√≥n

ü§± **Importancia cl√≠nica:**
‚Ä¢ **EHRN:** Enfermedad hemol√≠tica del reci√©n nacido
‚Ä¢ **Reacciones:** Hem√≥lisis severa si incompatible
‚Ä¢ **Profilaxis:** RhoGAM en embarazadas Rh negativas

üìä **Gen√©tica Rh:**
‚Ä¢ **Rh positivo:** Al menos un gen D
‚Ä¢ **Rh negativo:** Ausencia completa gen D (dd)
‚Ä¢ **Herencia:** Mendeliana simple para D

‚ö†Ô∏è **Variantes Rh:**
‚Ä¢ **Du d√©bil:** Requiere t√©cnicas especiales
‚Ä¢ **Rh variantes:** D parcial, categor√≠as raras
‚Ä¢ **Tipificaci√≥n extendida:** C, E, c, e seg√∫n necesidad

¬øNecesitas informaci√≥n sobre alg√∫n aspecto espec√≠fico del sistema Rh?`;
        }
        
        function generatePregnancyResponse(question) {
            return `**Medicina Transfusional en Embarazo**

ü§± **Screening obst√©trico:**
‚Ä¢ **Tipificaci√≥n:** ABO/Rh obligatoria
‚Ä¢ **Anticuerpos irregulares:** Panel completo
‚Ä¢ **Seguimiento:** Seriado seg√∫n anticuerpos detectados

ü©∏ **Anti-D en embarazo:**
‚Ä¢ **T√≠tulos:** Cuantificaci√≥n seriada
‚Ä¢ **Doppler:** Monitoreo arteria cerebral media fetal
‚Ä¢ **RhoGAM:** Profilaxis 28 semanas y posparto
‚Ä¢ **Referencia:** Medicina materno-fetal si t√≠tulo >32

üìä **Otros anticuerpos significativos:**
‚Ä¢ **Anti-K:** Monitoreo estrecho, EHRN severa
‚Ä¢ **Anti-E, -c:** Seguimiento seg√∫n t√≠tulos
‚Ä¢ **Anti-Jka, -Jkb:** Potencial hem√≥lisis tard√≠a

üî¨ **Monitoreo fetal:**
‚Ä¢ **T√≠tulos <16:** Seguimiento cada 4 semanas
‚Ä¢ **T√≠tulos 16-32:** Cada 2 semanas + Doppler
‚Ä¢ **T√≠tulos >32:** Semanal + centro especializado

‚ö†Ô∏è **EHRN - Enfermedad hemol√≠tica:**
‚Ä¢ **Prevenci√≥n:** Identificaci√≥n temprana anticuerpos
‚Ä¢ **Tratamiento:** Transfusi√≥n intrauterina si severa
‚Ä¢ **Neonatal:** Fototerapia, exanguinotransfusi√≥n

¬øTienes alg√∫n caso espec√≠fico de embarazo que quieras consultar?`;
        }
        
        function generateTransfusionResponse(question) {
            return `**Protocolos de Transfusi√≥n Sangu√≠nea**

ü©∏ **Preparaci√≥n pre-transfusional:**
‚Ä¢ **Muestra:** Fresca (<72 horas)
‚Ä¢ **Identificaci√≥n:** Doble verificaci√≥n paciente
‚Ä¢ **Tipificaci√≥n:** ABO/Rh confirmada
‚Ä¢ **Crossmatch:** Compatible obligatorio

üìã **Selecci√≥n de productos:**
‚Ä¢ **GR:** ABO id√©ntico, Rh compatible
‚Ä¢ **Plasma:** ABO compatible (reverso)
‚Ä¢ **Plaquetas:** ABO/Rh preferiblemente compatible
‚Ä¢ **Crioprecipitado:** ABO preferible

‚ö†Ô∏è **Verificaciones cr√≠ticas:**
‚Ä¢ **Identidad paciente:** Brazalete, pregunta directa
‚Ä¢ **Producto correcto:** Verificar etiquetas
‚Ä¢ **Compatibilidad:** Crossmatch negativo
‚Ä¢ **Caducidad:** Vigencia del producto

üî¨ **Durante la transfusi√≥n:**
‚Ä¢ **Signos vitales:** Baseline y cada 15 min
‚Ä¢ **Velocidad:** Seg√∫n tolerancia y indicaci√≥n
‚Ä¢ **Observaci√≥n:** Reacciones adversas
‚Ä¢ **Documentaci√≥n:** Completa en expediente

üö® **Emergencias transfusionales:**
‚Ä¢ **O negativo:** Universal para emergencias
‚Ä¢ **Crossmatch abreviado:** Si anticuerpos negativos
‚Ä¢ **Protocolo masivo:** Ratio 1:1:1

¬øNecesitas informaci√≥n sobre alg√∫n aspecto espec√≠fico de la transfusi√≥n?`;
        }
        
        function generateIntelligentBloodBankResponse(question) {
            return `Interesante consulta sobre **"${question}"** en el contexto de banco de sangre.

ü©∏ **Como experto en medicina transfusional**, puedo ayudarte con an√°lisis detallado de:

üî¨ **TEMAS ESPECIALIZADOS:**
‚Ä¢ **Anticuerpos complejos** y sus implicaciones cl√≠nicas
‚Ä¢ **Gen√©tica avanzada** de grupos sangu√≠neos  
‚Ä¢ **Protocolos espec√≠ficos** seg√∫n casos cl√≠nicos
‚Ä¢ **Interpretaci√≥n de pruebas** de laboratorio

üß™ **CASOS CL√çNICOS:**
‚Ä¢ **Crossmatch incompatible** - investigaci√≥n sistem√°tica
‚Ä¢ **Paneles complejos** - m√∫ltiples anticuerpos
‚Ä¢ **Reacciones transfusionales** - manejo integral
‚Ä¢ **Emergencias obst√©tricas** - protocolos especializados

üí° **SUGERENCIAS:**
¬øPodr√≠as ser m√°s espec√≠fico sobre qu√© aspecto te interesa? Por ejemplo:
‚Ä¢ ¬øEs sobre identificaci√≥n de anticuerpos?
‚Ä¢ ¬øNecesitas ayuda con interpretaci√≥n de pruebas?
‚Ä¢ ¬øEs un caso cl√≠nico complejo?
‚Ä¢ ¬øInvolucra gen√©tica o herencia?

**¬°Estoy aqu√≠ para ayudarte con cualquier complejidad en medicina transfusional!** üß¨`;
        }
        
        function formatResponse(category, content) {
            return {
                category: category,
                answer: content
            };
        }

        // Funciones de interfaz (mantenidas igual)
        function toggleFolder(tab, folderId) {
            try {
                document.querySelectorAll('.folder-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.folder-content').forEach(c => c.classList.remove('active'));
                
                tab.classList.add('active');
                const content = document.querySelector('.folder-content.' + folderId);
                if (content) {
                    content.classList.add('active');
                }
            } catch (error) {
                console.error('Error en toggleFolder:', error);
            }
        }

        function showModuleInfo(moduleName) {
            if (!isAssistantOpen) {
                toggleBludee();
            }
            if (isMinimized) {
                minimizeChat();
            }
            
            setTimeout(() => {
                const moduleInfo = `Informaci√≥n sobre: **${moduleName}**

ü©∏ **Sistema Bludee - Banco de Sangre**

Este m√≥dulo forma parte del sistema integral de gesti√≥n de componentes sangu√≠neos, dise√±ado espec√≠ficamente para laboratorios en Puerto Rico.

**üîß Estado:** En desarrollo activo
**üéØ Objetivo:** Gesti√≥n completa y segura de banco de sangre
**üìã Funcionalidades planificadas:**
‚Ä¢ Interface m√©dica especializada
‚Ä¢ Integraci√≥n con sistemas hospitalarios
‚Ä¢ Protocolos autom√°ticos de seguridad
‚Ä¢ Trazabilidad completa de componentes

üí° **Mientras tanto, puedo ayudarte con:**
‚Ä¢ **Consultas m√©dicas especializadas** sobre medicina transfusional
‚Ä¢ **Interpretaci√≥n de pruebas** de laboratorio
‚Ä¢ **Protocolos cl√≠nicos** y manejo de casos
‚Ä¢ **Gen√©tica de grupos sangu√≠neos** y herencia

¬øTe gustar√≠a consultar algo espec√≠fico sobre medicina transfusional relacionado con este m√≥dulo?`;
                
                addMessage(moduleInfo, false);
            }, 500);
        }

        function toggleBludee() {
            try {
                const assistant = document.getElementById('bludeeAssistant');
                const toggle = document.querySelector('.bludee-toggle');
                
                if (!assistant || !toggle) return;
                
                if (isAssistantOpen) {
                    assistant.classList.remove('active', 'minimized');
                    toggle.classList.remove('hidden');
                    isAssistantOpen = false;
                    isMinimized = false;
                } else {
                    assistant.classList.add('active');
                    toggle.classList.add('hidden');
                    isAssistantOpen = true;
                    isMinimized = false;
                    
                    if (!chatInitialized) {
                        showWelcomeMessage();
                        chatInitialized = true;
                    }
                }
                updateUI();
            } catch (error) {
                console.error('Error en toggleBludee:', error);
            }
        }

        function minimizeChat() {
            if (!isAssistantOpen) return;
            
            try {
                const assistant = document.getElementById('bludeeAssistant');
                
                if (isMinimized) {
                    assistant.classList.remove('minimized');
                    isMinimized = false;
                    setTimeout(() => {
                        const input = document.getElementById('chatInput');
                        if (input) input.focus();
                    }, 300);
                } else {
                    assistant.classList.add('minimized');
                    isMinimized = true;
                }
                updateUI();
            } catch (error) {
                console.error('Error en minimizeChat:', error);
            }
        }

        function headerClick() {
            if (isMinimized) {
                minimizeChat();
            }
        }

        function updateUI() {
            try {
                const statusText = document.getElementById('assistantStatus');
                const minimizeBtn = document.getElementById('minimizeBtn');
                
                if (!statusText || !minimizeBtn) return;
                
                if (isMinimized) {
                    statusText.textContent = 'Haz clic para maximizar';
                    minimizeBtn.innerHTML = '‚¨ÜÔ∏è';
                    minimizeBtn.title = 'Maximizar';
                } else {
                    statusText.textContent = 'Experto en medicina transfusional';
                    minimizeBtn.innerHTML = '‚¨áÔ∏è';
                    minimizeBtn.title = 'Minimizar';
                }
            } catch (error) {
                console.error('Error en updateUI:', error);
            }
        }

        function showWelcomeMessage() {
            try {
                if (isMinimized) {
                    minimizeChat();
                }
                
                setTimeout(() => {
                    const welcomeMessage = `¬°Bienvenido! Soy **Bludee IA** ü©∏ü§ñ

**EXPERTO COMPLETO EN BANCO DE SANGRE**

üî¨ **Mi especialidad incluye:**
‚Ä¢ **Anticuerpos:** Anti-K, Anti-D, Anti-E, Anti-c y todos los sistemas
‚Ä¢ **Crossmatch:** Compatibilidad, investigaci√≥n de incompatibilidades
‚Ä¢ **Panel de anticuerpos:** Identificaci√≥n e interpretaci√≥n completa
‚Ä¢ **DAT y elu√≠do:** An√°lisis detallado de resultados
‚Ä¢ **Gen√©tica:** Herencia ABO/Rh, c√°lculos padre-madre-beb√©
‚Ä¢ **Protocolos:** Emergencias, transfusi√≥n masiva, reacciones
‚Ä¢ **Embarazo:** Anti-D, EHRN, seguimiento obst√©trico

**üí° Puedes preguntarme CUALQUIER cosa sobre banco de sangre:**
Desde conceptos b√°sicos hasta casos cl√≠nicos complejos.

**¬øQu√© consulta tienes hoy?**`;
                    
                    addMessage(welcomeMessage, false);
                    
                    setTimeout(() => {
                        showQuickOptions();
                    }, 1000);
                }, 500);
            } catch (error) {
                console.error('Error en showWelcomeMessage:', error);
            }
        }

        function showQuickOptions() {
            try {
                const quickOptions = [
                    "¬øQu√© es anti-K?",
                    "Crossmatch incompatible",
                    "Panel de anticuerpos",
                    "Gen√©tica padre-madre-beb√©",
                    "Emergencia masiva",
                    "Anti-D en embarazo"
                ];
                
                const optionsHtml = quickOptions.map(option => 
                    `<button class="quick-btn" onclick="handleQuickOption('${option.replace(/'/g, "\\\'")}')">${option}</button>`
                ).join('');
                
                const messagesContainer = document.getElementById('chatMessages');
                if (!messagesContainer) return;
                
                const optionsDiv = document.createElement('div');
                optionsDiv.className = 'message';
                optionsDiv.innerHTML = `
                    <div class="bot-message">
                        <div class="expert-tag">ü©∏ Consultas expertas</div>
                        <div class="quick-options">
                            ${optionsHtml}
                        </div>
                    </div>
                `;
                messagesContainer.appendChild(optionsDiv);
                scrollToBottom();
            } catch (error) {
                console.error('Error en showQuickOptions:', error);
            }
        }

        function addMessage(message, isUser = false) {
            try {
                const messagesContainer = document.getElementById('chatMessages');
                if (!messagesContainer) return;
                
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message';
                
                const messageContent = document.createElement('div');
                messageContent.className = isUser ? 'user-message' : 'bot-message';
                
                let html = '';
                if (!isUser) {
                    html += `<div class="expert-tag">ü©∏ Experto MT</div>`;
                }
                
                html += message
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/\*(.*?)\*/g, '<em>$1</em>')
                    .replace(/\n/g, '<br>');
                
                messageContent.innerHTML = html;
                messageDiv.appendChild(messageContent);
                messagesContainer.appendChild(messageDiv);
                scrollToBottom();

                // Guardar en historial
                conversationHistory.push({
                    role: isUser ? 'user' : 'assistant',
                    content: message,
                    timestamp: new Date().toISOString()
                });
                
            } catch (error) {
                console.error('Error en addMessage:', error);
            }
        }

        function scrollToBottom() {
            try {
                const messagesContainer = document.getElementById('chatMessages');
                if (messagesContainer) {
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                }
            } catch (error) {
                console.error('Error en scrollToBottom:', error);
            }
        }

        function showTyping() {
            try {
                const indicator = document.getElementById('typingIndicator');
                if (indicator) {
                    indicator.style.display = 'flex';
                    scrollToBottom();
                }
            } catch (error) {
                console.error('Error en showTyping:', error);
            }
        }

        function hideTyping() {
            try {
                const indicator = document.getElementById('typingIndicator');
                if (indicator) {
                    indicator.style.display = 'none';
                }
            } catch (error) {
                console.error('Error en hideTyping:', error);
            }
        }

        function handleQuickOption(option) {
            try {
                sendMessage(option);
            } catch (error) {
                console.error('Error en handleQuickOption:', error);
            }
        }

        function sendMessage(messageText = null) {
            try {
                const input = document.getElementById('chatInput');
                const sendBtn = document.getElementById('sendBtn');
                
                if (!input || !sendBtn) return;
                
                const message = messageText || input.value.trim();
                
                if (!message) return;
                
                if (isMinimized) {
                    minimizeChat();
                }
                
                // Deshabilitar controles
                input.disabled = true;
                sendBtn.disabled = true;
                
                // Agregar mensaje del usuario
                addMessage(message, true);
                
                // Limpiar input si no es mensaje predefinido
                if (!messageText) {
                    input.value = '';
                    autoResize(input);
                }
                
                // Mostrar indicador de escritura
                showTyping();
                
                // Procesar con IA especializada en banco de sangre
                setTimeout(() => {
                    try {
                        hideTyping();
                        const result = generateBloodBankResponse(message);
                        addMessage(result.answer, false);
                        
                        // Rehabilitar controles
                        input.disabled = false;
                        sendBtn.disabled = false;
                        input.focus();
                    } catch (processingError) {
                        console.error('Error procesando respuesta:', processingError);
                        hideTyping();
                        addMessage('Ups, tuve un problema procesando esa consulta m√©dica. ¬øPodr√≠as reformular tu pregunta sobre banco de sangre? ü©∏', false);
                        
                        // Rehabilitar controles
                        input.disabled = false;
                        sendBtn.disabled = false;
                    }
                }, 1000 + Math.random() * 1000);
                
            } catch (error) {
                console.error('Error en sendMessage:', error);
                
                const input = document.getElementById('chatInput');
                const sendBtn = document.getElementById('sendBtn');
                if (input) input.disabled = false;
                if (sendBtn) sendBtn.disabled = false;
                
                hideTyping();
                addMessage('Error temporal. Por favor intenta nuevamente tu consulta m√©dica. üîÑ', false);
            }
        }

        function handleEnterKey(event) {
            try {
                if (event.key === 'Enter' && !event.shiftKey) {
                    event.preventDefault();
                    sendMessage();
                }
            } catch (error) {
                console.error('Error en handleEnterKey:', error);
            }
        }

        function autoResize(textarea) {
            try {
                if (textarea) {
                    textarea.style.height = 'auto';
                    textarea.style.height = Math.min(textarea.scrollHeight, 80) + 'px';
                }
            } catch (error) {
                console.error('Error en autoResize:', error);
            }
        }

        // Inicializaci√≥n
        function initializeApp() {
            try {
                console.log('ü©∏ Bludee IA - Experto en Banco de Sangre COMPLETO cargado');
                console.log('‚úÖ Base de conocimiento m√©dico especializada activada');
                console.log('üß¨ Gen√©tica, crossmatch, panel de anticuerpos disponibles');
                updateUI();
                
            } catch (error) {
                console.error('Error en inicializaci√≥n:', error);
            }
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', initializeApp);
        window.addEventListener('load', initializeApp);

        // Manejo de errores
        window.addEventListener('error', function(e) {
            console.error('Error capturado:', e.error);
        });

    </script>
</body>
</html>
