<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BLUDEE - Sistema de Banco de Sangre</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(220,38,38,0.1)" stroke-width="0.5"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
            opacity: 0.3;
        }

        .header h1 {
            color: #dc2626;
            font-size: 2.8em;
            margin-bottom: 10px;
            font-weight: 700;
            position: relative;
            z-index: 2;
        }

        .header .subtitle {
            color: #7f8c8d;
            font-size: 1.3em;
            margin-bottom: 20px;
            position: relative;
            z-index: 2;
        }

        .system-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 25px;
            position: relative;
            z-index: 2;
        }

        .status-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid #e9ecef;
        }

        .status-number {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .status-label {
            font-size: 0.9rem;
            color: #6c757d;
        }

        .status-available { color: #28a745; }
        .status-pending { color: #ffc107; }
        .status-critical { color: #dc3545; }
        .status-users { color: #007bff; }

        .user-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f8f9fa;
            padding: 15px 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .user-welcome {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #dc2626, #ef4444);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .user-details h3 {
            color: #2c3e50;
            font-size: 1.2em;
        }

        .user-details p {
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .current-time {
            color: #6c757d;
            font-weight: 500;
        }

        .alerts-banner {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border: 2px solid #f59e0b;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            display: none;
        }

        .alerts-banner.show {
            display: block;
            animation: slideDown 0.5s ease;
        }

        .alerts-title {
            color: #92400e;
            font-weight: 600;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .alerts-list {
            color: #92400e;
            line-height: 1.6;
        }

        .main-menu {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .menu-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .menu-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--section-color);
            border-radius: 20px 20px 0 0;
        }

        .menu-section:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        .section-emergency { --section-color: linear-gradient(135deg, #dc2626, #ef4444); }
        .section-inventory { --section-color: linear-gradient(135deg, #2563eb, #3b82f6); }
        .section-clinical { --section-color: linear-gradient(135deg, #059669, #10b981); }
        .section-reports { --section-color: linear-gradient(135deg, #ea580c, #f97316); }
        .section-admin { --section-color: linear-gradient(135deg, #7c3aed, #8b5cf6); }
        .section-quality { --section-color: linear-gradient(135deg, #0891b2, #06b6d4); }

        .menu-section h3 {
            color: #2c3e50;
            font-size: 1.4em;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .menu-section .icon {
            font-size: 1.8em;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            color: white;
            background: var(--section-color);
        }

        .menu-item {
            display: block;
            padding: 15px 20px;
            margin: 10px 0;
            background: #f8f9fa;
            border: none;
            border-radius: 12px;
            text-decoration: none;
            color: #2c3e50;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
            width: 100%;
            text-align: left;
            border: 2px solid transparent;
            position: relative;
        }

        .menu-item:hover {
            background: #e9ecef;
            transform: translateX(8px);
            border-color: var(--section-color);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .menu-item.emergency {
            background: linear-gradient(135deg, #fef2f2, #fee2e2);
            color: #991b1b;
            font-weight: 600;
        }

        .menu-item.emergency:hover {
            background: linear-gradient(135deg, #fee2e2, #fecaca);
            transform: translateX(8px) scale(1.02);
        }

        .menu-item.integrated {
            background: linear-gradient(135deg, #e0f2fe, #b3e5fc);
            color: #0277bd;
            font-weight: 600;
        }

        .menu-item.integrated:hover {
            background: linear-gradient(135deg, #b3e5fc, #81d4fa);
            transform: translateX(8px) scale(1.02);
        }

        .quick-actions {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            margin-bottom: 30px;
        }

        .quick-actions h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
        }

        .action-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            text-decoration: none;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }

        .action-card.integrated-action {
            background: linear-gradient(135deg, #0891b2, #06b6d4);
        }

        .action-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

        .action-card .icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .action-card .title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .action-card .description {
            font-size: 0.85rem;
            opacity: 0.9;
        }

        .legend-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            margin-bottom: 30px;
        }

        .legend-section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .legend-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .legend-green { background-color: #28a745; }
        .legend-yellow { background-color: #ffc107; }
        .legend-red { background-color: #dc3545; }
        .legend-gray { background-color: #6c757d; }

        .footer {
            text-align: center;
            margin-top: 40px;
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9em;
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .logout-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #dc2626, #ef4444);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
        }

        .logout-btn:hover {
            background: linear-gradient(135deg, #b91c1c, #dc2626);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(220, 38, 38, 0.4);
        }

        /* ESTILOS PARA EL M√ìDULO INTEGRAL */
        .integrated-module {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            z-index: 1001;
            overflow: auto;
            padding: 20px;
        }

        .integrated-module.active {
            display: block;
        }

        .module-container {
            min-width: 1400px;
            margin: 0 auto;
        }

        .module-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 3px solid #0891b2;
            background: linear-gradient(135deg, #e0f7fa, #b2ebf2);
            padding: 20px;
            border-radius: 10px;
        }

        .module-header h2 {
            color: #0891b2;
            margin: 0;
            font-size: 1.8em;
        }

        .module-buttons {
            display: flex;
            gap: 10px;
        }

        .module-btn {
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-close {
            background-color: #dc3545;
            color: white;
        }

        .btn-new {
            background-color: #28a745;
            color: white;
        }

        .btn-save {
            background-color: #007bff;
            color: white;
        }

        .btn-print {
            background-color: #6c757d;
            color: white;
        }

        .module-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        /* Panel de control */
        .control-panel {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid #e9ecef;
        }

        .status-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .status-filter {
            padding: 8px 16px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .status-filter.active {
            border-color: #0891b2;
            background: #0891b2;
            color: white;
        }

        /* Formulario mejorado */
        .enhanced-form {
            background: #ffffff;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border: 2px solid #e9ecef;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }

        .form-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        .form-status {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .status-recibida { background: #d4edda; color: #155724; }
        .status-proceso { background: #fff3cd; color: #856404; }
        .status-despachada { background: #d1ecf1; color: #0c5460; }
        .status-devuelta { background: #f8d7da; color: #721c24; }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 13px;
            color: #495057;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 10px 12px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 13px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #0891b2;
            box-shadow: 0 0 0 3px rgba(8, 145, 178, 0.1);
        }

        .form-row-full {
            grid-column: 1 / -1;
        }

        .form-actions {
            grid-column: 1 / -1;
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #e9ecef;
        }

        /* Tabla mejorada */
        .enhanced-table {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }

        .table-controls {
            background: #f8f9fa;
            padding: 15px 20px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: between;
            align-items: center;
            gap: 15px;
        }

        .search-box {
            flex: 1;
            max-width: 300px;
        }

        .search-box input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        .table-wrapper {
            overflow-x: auto;
            max-height: 600px;
        }

        .tracking-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }

        .tracking-table th {
            background: linear-gradient(135deg, #0891b2, #06b6d4);
            color: white;
            padding: 12px 8px;
            text-align: center;
            font-weight: bold;
            position: sticky;
            top: 0;
            z-index: 10;
            border-right: 1px solid rgba(255,255,255,0.2);
        }

        .tracking-table td {
            padding: 10px 8px;
            text-align: center;
            border-bottom: 1px solid #e9ecef;
            border-right: 1px solid #e9ecef;
            min-width: 80px;
            max-width: 120px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .tracking-table tbody tr:hover {
            background-color: #e8f4fd;
            cursor: pointer;
        }

        .tracking-table tbody tr.selected {
            background-color: #b3e5fc;
        }

        .row-actions {
            display: flex;
            gap: 5px;
            justify-content: center;
        }

        .action-btn {
            padding: 4px 8px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.3s ease;
        }

        .btn-edit {
            background: #ffc107;
            color: #212529;
        }

        .btn-delete {
            background: #dc3545;
            color: white;
        }

        .btn-duplicate {
            background: #6c757d;
            color: white;
        }

        .action-btn:hover {
            transform: scale(1.1);
        }

        /* Notificaciones */
        .notification {
            position: fixed;
            top: 80px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1002;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
        }

        .notification.show {
            opacity: 1;
            transform: translateX(0);
        }

        .notification.success {
            background: #28a745;
        }

        .notification.warning {
            background: #ffc107;
            color: #212529;
        }

        .notification.error {
            background: #dc3545;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media print {
            .integrated-module {
                position: static;
                display: block !important;
            }
            .module-header button,
            .enhanced-form,
            .control-panel {
                display: none !important;
            }
            body {
                margin: 0;
            }
            .module-container {
                width: 100%;
                min-width: unset;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2.2em;
            }
            
            .main-menu {
                grid-template-columns: 1fr;
            }
            
            .user-info {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .system-status {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .actions-grid {
                grid-template-columns: 1fr;
            }
            
            .legend-grid {
                grid-template-columns: 1fr;
            }

            .module-container {
                min-width: unset;
                overflow-x: auto;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .module-buttons {
                flex-wrap: wrap;
            }

            .status-selector {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <button class="logout-btn" onclick="logout()">üö™ Cerrar Sesi√≥n</button>
    
    <!-- P√ÅGINA PRINCIPAL -->
    <div class="container" id="mainPage">
        <!-- Header Principal -->
        <div class="header">
            <h1>ü©∏ BLUDEE</h1>
            <p class="subtitle">Sistema Integral de Banco de Sangre - Puerto Rico</p>
            
            <div class="system-status">
                <div class="status-card">
                    <div class="status-number status-available" id="available-units">45</div>
                    <div class="status-label">Unidades Disponibles</div>
                </div>
                <div class="status-card">
                    <div class="status-number status-pending" id="pending-requests">3</div>
                    <div class="status-label">En Proceso</div>
                </div>
                <div class="status-card">
                    <div class="status-number status-critical" id="critical-alerts">2</div>
                    <div class="status-label">Alertas Cr√≠ticas</div>
                </div>
                <div class="status-card">
                    <div class="status-number status-users" id="active-users">8</div>
                    <div class="status-label">Usuarios Activos</div>
                </div>
            </div>
        </div>

        <!-- Informaci√≥n del Usuario -->
        <div class="user-info">
            <div class="user-welcome">
                <div class="user-avatar" id="user-avatar">NM</div>
                <div class="user-details">
                    <h3 id="username">Norma I. Medina, MT</h3>
                    <p id="user-role">Tecn√≥logo M√©dico Principal</p>
                </div>
            </div>
            <div class="current-time" id="current-time"></div>
        </div>

        <!-- Banner de Alertas -->
        <div class="alerts-banner" id="alerts-banner">
            <div class="alerts-title">
                <span>‚ö†Ô∏è</span>
                <span>Alertas del Sistema</span>
            </div>
            <div class="alerts-list" id="alerts-list">
                <!-- Se cargar√°n din√°micamente -->
            </div>
        </div>

        <!-- Acciones R√°pidas -->
        <div class="quick-actions">
            <h3>‚ö° Acciones R√°pidas</h3>
            <div class="actions-grid">
                <button class="action-card integrated-action" onclick="openIntegratedModule('emergency')">
                    <div class="icon">üö®</div>
                    <div class="title">Emergencia</div>
                    <div class="description">Despacho urgente</div>
                </button>
                <button class="action-card integrated-action" onclick="openIntegratedModule('receive')">
                    <div class="icon">üì•</div>
                    <div class="title">Recibir Unidad</div>
                    <div class="description">Nueva unidad</div>
                </button>
                <button class="action-card integrated-action" onclick="openIntegratedModule('dispatch')">
                    <div class="icon">üì§</div>
                    <div class="title">Despachar Unidad</div>
                    <div class="description">Enviar a √°rea</div>
                </button>
                <button class="action-card integrated-action" onclick="openIntegratedModule('tracking')">
                    <div class="icon">üìä</div>
                    <div class="title">Registro Completo</div>
                    <div class="description">Ver todas las unidades</div>
                </button>
            </div>
        </div>

        <!-- Men√∫ Principal -->
        <div class="main-menu">
            <!-- Inventario y Control -->
            <div class="menu-section section-inventory">
                <h3><span class="icon">üì¶</span>Inventario y Control</h3>
                <a class="menu-item" href="inventario_actual.html">üìä Inventario Actual</a>
                <a class="menu-item" href="trazabilidad_banco_sangre.html">üîÑ Trazabilidad</a>
                <a class="menu-item" href="gestion_de_donantes.html">üë• Gesti√≥n de Donantes</a>
                <a class="menu-item" href="modulo_componentes_devueltos.html">üì¶ Componentes Devueltos</a>
            </div>

            <!-- √Årea Cl√≠nica -->
            <div class="menu-section section-clinical">
                <h3><span class="icon">üè•</span>√Årea Cl√≠nica</h3>
                <a class="menu-item" href="notas_clinicas_internas.html">üìù Notas Cl√≠nicas</a>
                <a class="menu-item" href="historial_transfusion_paciente.html">üìã Historial de Transfusi√≥n</a>
                <a class="menu-item" href="prueba_de_compatibilidad.html">üî¨ Pruebas de Compatibilidad</a>
                <a class="menu-item" href="#" onclick="showTransfusionModule()">üíâ Registro de Transfusiones</a>
            </div>

            <!-- Reportes y An√°lisis -->
            <div class="menu-section section-reports">
                <h3><span class="icon">üìä</span>Reportes y An√°lisis</h3>
                <a class="menu-item" href="expedientes_mensuales.html">üìã Expedientes Mensuales</a>
                <a class="menu-item" href="auditorias_y_logs.html">üìã Auditor√≠as y Logs</a>
                <a class="menu-item" href="#" onclick="showStatsModule()">üìà Estad√≠sticas Generales</a>
                <a class="menu-item" href="#" onclick="showQualityModule()">üéØ Indicadores de Calidad</a>
            </div>

            <!-- Administraci√≥n y Soporte -->
            <div class="menu-section section-admin">
                <h3><span class="icon">‚öôÔ∏è</span>Administraci√≥n y Soporte</h3>
                <a class="menu-item" href="usuarios.html">üë• Gesti√≥n de Usuarios</a>
                <a class="menu-item" href="chatbot.html">ü§ñ Asistente Virtual</a>
                <a class="menu-item" href="#" onclick="showConfigModule()">‚öôÔ∏è Configuraci√≥n del Sistema</a>
                <a class="menu-item" href="#" onclick="showBackupModule()">üíæ Respaldos y Mantenimiento</a>
                <a class="menu-item" href="#" onclick="showHelpModule()">‚ùì Ayuda y Capacitaci√≥n</a>
            </div>
        </div>

        <!-- Leyenda de Estados -->
        <div class="legend-section">
            <h3>üìã Estados del Sistema</h3>
            <div class="legend-grid">
                <div class="legend-item">
                    <div class="legend-color" style="background: #d4edda;"></div>
                    <span><strong>Recibida:</strong> Unidad recibida, en proceso de registro</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #fff3cd;"></div>
                    <span><strong>En Proceso:</strong> Verificaciones en curso</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #d1ecf1;"></div>
                    <span><strong>Despachada:</strong> Unidad entregada al √°rea solicitante</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #f8d7da;"></div>
                    <span><strong>Devuelta:</strong> Unidad retornada al banco</span>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>&copy; 2025 BLUDEE - Sistema de Banco de Sangre | Puerto Rico</p>
            <p>Versi√≥n 3.0 | "M√≥dulo Integral - Una sola herramienta, control total"</p>
        </div>
    </div>

    <!-- M√ìDULO INTEGRAL DE UNIDADES -->
    <div class="integrated-module" id="integratedModule">
        <div class="module-container">
            <!-- Header del m√≥dulo -->
            <div class="module-header">
                <div>
                    <h2 id="moduleTitle">üîÑ M√≥dulo Integral de Unidades</h2>
                    <p>Control completo: Recibo ‚Ä¢ Seguimiento ‚Ä¢ Despacho | <strong id="moduleDate"></strong></p>
                </div>
                <div class="module-buttons">
                    <button class="module-btn btn-close" onclick="closeIntegratedModule()">
                        <span>‚ùå</span> Cerrar
                    </button>
                    <button class="module-btn btn-new" onclick="newEntry()">
                        <span>‚ûï</span> Nueva Entrada
                    </button>
                    <button class="module-btn btn-save" onclick="saveCurrentEntry()" id="saveBtn" style="display: none;">
                        <span>üíæ</span> Guardar
                    </button>
                    <button class="module-btn btn-print" onclick="printModule()">
                        <span>üñ®Ô∏è</span> Imprimir
                    </button>
                </div>
            </div>

            <!-- Panel de control -->
            <div class="control-panel">
                <h4>Filtrar por estado:</h4>
                <div class="status-selector">
                    <div class="status-filter active" data-status="all" onclick="filterByStatus('all')">
                        Todas (Mostrar todo)
                    </div>
                    <div class="status-filter" data-status="recibida" onclick="filterByStatus('recibida')">
                        üì• Recibidas
                    </div>
                    <div class="status-filter" data-status="proceso" onclick="filterByStatus('proceso')">
                        ‚è≥ En Proceso
                    </div>
                    <div class="status-filter" data-status="despachada" onclick="filterByStatus('despachada')">
                        üì§ Despachadas
                    </div>
                    <div class="status-filter" data-status="devuelta" onclick="filterByStatus('devuelta')">
                        üîÑ Devueltas
                    </div>
                </div>
            </div>

            <!-- Formulario integral -->
            <div class="enhanced-form" id="entryForm" style="display: none;">
                <div class="form-header">
                    <h3 id="formTitle">Nueva Entrada</h3>
                    <div class="form-status">
                        <span>Estado:</span>
                        <span class="status-badge status-recibida" id="entryStatus">Recibida</span>
                    </div>
                </div>

                <div class="form-grid">
                    <!-- Informaci√≥n b√°sica -->
                    <div class="form-group">
                        <label for="fecha">Fecha:</label>
                        <input type="date" id="fecha" required>
                    </div>
                    <div class="form-group">
                        <label for="tipoOperacion">Tipo de Operaci√≥n:</label>
                        <select id="tipoOperacion" onchange="updateFormMode()">
                            <option value="recibo">üì• Recibo de Unidad</option>
                            <option value="despacho">üì§ Despacho de Unidad</option>
                            <option value="emergencia">üö® Despacho de Emergencia</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="numeroUnidad">N√∫mero de Unidad:</label>
                        <input type="text" id="numeroUnidad" placeholder="Auto-generado" readonly>
                    </div>
                    <div class="form-group">
                        <label for="estadoUnidad">Estado de la Unidad:</label>
                        <select id="estadoUnidad">
                            <option value="recibida">Recibida</option>
                            <option value="proceso">En Proceso</option>
                            <option value="despachada">Despachada</option>
                            <option value="devuelta">Devuelta</option>
                        </select>
                    </div>

                    <!-- Informaci√≥n del paciente -->
                    <div class="form-group">
                        <label for="paciente">Paciente:</label>
                        <input type="text" id="paciente" placeholder="Nombre del paciente">
                    </div>
                    <div class="form-group">
                        <label for="record">Record:</label>
                        <input type="text" id="record" placeholder="N√∫mero de record">
                    </div>
                    <div class="form-group">
                        <label for="localizacion">Localizaci√≥n/Destino:</label>
                        <select id="localizacion">
                            <option value="">Seleccionar...</option>
                            <option value="Emergencia">Emergencia</option>
                            <option value="Cirug√≠a">Cirug√≠a</option>
                            <option value="UCI">UCI</option>
                            <option value="Medicina Interna">Medicina Interna</option>
                            <option value="Pediatr√≠a">Pediatr√≠a</option>
                            <option value="Obstetricia">Obstetricia</option>
                            <option value="Banco de Sangre">Banco de Sangre</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="suplidor">Suplidor:</label>
                        <input type="text" id="suplidor" placeholder="Cruz Roja PR">
                    </div>

                    <!-- Informaci√≥n m√©dica -->
                    <div class="form-group">
                        <label for="medico">M√©dico Solicitante:</label>
                        <input type="text" id="medico" placeholder="Dr/Dra. Nombre">
                    </div>
                    <div class="form-group">
                        <label for="aboRhPaciente">ABO/Rh Paciente:</label>
                        <select id="aboRhPaciente">
                            <option value="">Seleccionar...</option>
                            <option value="O+">O+</option>
                            <option value="O-">O-</option>
                            <option value="A+">A+</option>
                            <option value="A-">A-</option>
                            <option value="B+">B+</option>
                            <option value="B-">B-</option>
                            <option value="AB+">AB+</option>
                            <option value="AB-">AB-</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="aboRhDonante">ABO/Rh Donante:</label>
                        <select id="aboRhDonante">
                            <option value="">Seleccionar...</option>
                            <option value="O+">O+</option>
                            <option value="O-">O-</option>
                            <option value="A+">A+</option>
                            <option value="A-">A-</option>
                            <option value="B+">B+</option>
                            <option value="B-">B-</option>
                            <option value="AB+">AB+</option>
                            <option value="AB-">AB-</option>
                        </select>
                    </div>
                    <!-- Detalles t√©cnicos -->
                    <div class="form-group">
                        <label for="componente">Componente:</label>
                        <select id="componente">
                            <option value="">Seleccionar...</option>
                            <option value="PRBC Completa">PRBC Completa</option>
                            <option value="PRBC Fraccionada">PRBC Fraccionada</option>
                            <option value="Plasma">Plasma</option>
                            <option value="Plaquetas">Plaquetas</option>
                            <option value="Crioprecipitado">Crioprecipitado</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="volumen">Volumen (ml):</label>
                        <input type="number" id="volumen" placeholder="250">
                    </div>
                    <div class="form-group">
                        <label for="fechaExpiracion">Fecha Expiraci√≥n:</label>
                        <input type="date" id="fechaExpiracion">
                    </div>
                    <div class="form-group">
                        <label for="transportTemp">Transport Temp (¬∞C):</label>
                        <input type="number" id="transportTemp" step="0.1" placeholder="4.0">
                    </div>

                    <!-- Control de tiempo -->
                    <div class="form-group">
                        <label for="timeReceived">Hora Recibida:</label>
                        <input type="time" id="timeReceived">
                    </div>
                    <div class="form-group">
                        <label for="timeDispatched">Hora Despachada:</label>
                        <input type="time" id="timeDispatched">
                    </div>
                    <div class="form-group">
                        <label for="inspeccion">Inspecci√≥n:</label>
                        <select id="inspeccion">
                            <option value="">Seleccionar...</option>
                            <option value="Aprobada">Aprobada</option>
                            <option value="Rechazada">Rechazada</option>
                            <option value="Pendiente">Pendiente</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="returned">Devuelta:</label>
                        <select id="returned">
                            <option value="No">No</option>
                            <option value="S√≠">S√≠</option>
                        </select>
                    </div>

                    <!-- Personal responsable -->
                    <div class="form-group">
                        <label for="mt">T√©cnico Responsable (MT):</label>
                        <input type="text" id="mt" placeholder="Nombre del MT">
                    </div>
                    <div class="form-group">
                        <label for="releasedBy">Released by:</label>
                        <input type="text" id="releasedBy" placeholder="Nombre">
                    </div>
                    <div class="form-group">
                        <label for="receivedBy">Received by:</label>
                        <input type="text" id="receivedBy" placeholder="Nombre">
                    </div>
                    <div class="form-group">
                        <label for="personaNotificada">Persona Notificada:</label>
                        <input type="text" id="personaNotificada" placeholder="Nombre">
                    </div>

                    <!-- Comentarios -->
                    <div class="form-group form-row-full">
                        <label for="comentarios">Comentarios/Observaciones:</label>
                        <textarea id="comentarios" rows="3" placeholder="Observaciones adicionales..."></textarea>
                    </div>

                    <!-- Acciones del formulario -->
                    <div class="form-actions">
                        <button type="button" class="module-btn btn-close" onclick="cancelEntry()">Cancelar</button>
                        <button type="button" class="module-btn btn-save" onclick="saveEntry()">üíæ Guardar Entrada</button>
                        <button type="button" class="module-btn" style="background: #17a2b8; color: white;" onclick="saveAndContinue()">üíæ‚ûï Guardar y Continuar</button>
                    </div>
                </div>
            </div>

            <!-- Tabla integral -->
            <div class="enhanced-table">
                <div class="table-controls">
                    <div class="search-box">
                        <input type="text" placeholder="üîç Buscar por paciente, record, unidad..." onkeyup="searchEntries(this.value)">
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <span id="totalEntries">Total: 0 entradas</span>
                        <button class="module-btn" style="background: #17a2b8; color: white; padding: 6px 12px;" onclick="exportToCSV()">üìä Exportar</button>
                    </div>
                </div>
                
                <div class="table-wrapper">
                    <table class="tracking-table">
                        <thead>
                            <tr>
                                <th>Estado</th>
                                <th>Fecha</th>
                                <th>N¬∞ Unidad</th>
                                <th>Paciente</th>
                                <th>Record</th>
                                <th>Localizaci√≥n</th>
                                <th>M√©dico</th>
                                <th>ABO/Rh Paciente</th>
                                <th>ABO/Rh Donante</th>
                                <th>Componente</th>
                                <th>Volumen</th>
                                <th>Fecha Exp.</th>
                                <th>Suplidor</th>
                                <th>H. Recibida</th>
                                <th>H. Despachada</th>
                                <th>Temp. Transport</th>
                                <th>Inspecci√≥n</th>
                                <th>Persona Notificada</th>
                                <th>Hora Notif.</th>
                                <th>MT</th>
                                <th>Released by</th>
                                <th>Received by</th>
                                <th>Devuelta</th>
                                <th>Comentarios</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="integratedTableBody">
                            <!-- Entrada de ejemplo -->
                            <tr data-status="despachada">
                                <td><span class="status-badge status-despachada">DESPACHADA</span></td>
                                <td>2024-09-17</td>
                                <td>BLD-001</td>
                                <td>Mar√≠a Gonz√°lez</td>
                                <td>MG-001</td>
                                <td>Emergencia</td>
                                <td>Dr. Rodr√≠guez</td>
                                <td>O+</td>
                                <td>D-12345</td>
                                <td>O+</td>
                                <td>Gl√≥bulos Rojos</td>
                                <td>250ml</td>
                                <td>2024-10-15</td>
                                <td>Cruz Roja PR</td>
                                <td>08:30</td>
                                <td>09:00</td>
                                <td>4.2¬∞C</td>
                                <td>Aprobada</td>
                                <td>Enf. P√©rez</td>
                                <td>08:35</td>
                                <td>MT-Jos√©</td>
                                <td>Lab-Ana</td>
                                <td>Enf-Luis</td>
                                <td>No</td>
                                <td>Transfusi√≥n exitosa</td>
                                <td>
                                    <div class="row-actions">
                                        <button class="action-btn btn-edit" onclick="editEntry(0)" title="Editar">‚úèÔ∏è</button>
                                        <button class="action-btn btn-duplicate" onclick="duplicateEntry(0)" title="Duplicar">üìã</button>
                                        <button class="action-btn btn-delete" onclick="deleteEntry(0)" title="Eliminar">üóëÔ∏è</button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Notificaci√≥n -->
    <div class="notification" id="notification"></div>

    <script>
        // Variables globales
        let currentUser = {
            name: 'Norma I. Medina',
            role: 'Tecn√≥logo M√©dico Principal',
            initials: 'NM'
        };

        let currentEntries = [];
        let editingIndex = -1;
        let unitCounter = 1;

        // Actualizar fecha y hora
        function updateDateTime() {
            const now = new Date();
            const options = {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            };
            document.getElementById('current-time').textContent = now.toLocaleString('es-PR', options);
        }

        // Navegaci√≥n general
        function navigateTo(page) {
            if (page.startsWith('#')) {
                alert(`Navegando a: ${page}\n\nM√≥dulo en desarrollo...`);
            } else {
                window.location.href = page;
            }
        }

        // FUNCIONES DEL M√ìDULO INTEGRAL
        function openIntegratedModule(mode = 'tracking') {
            document.getElementById('integratedModule').classList.add('active');
            document.getElementById('mainPage').style.display = 'none';
            
            // Actualizar fecha actual
            const today = new Date();
            document.getElementById('moduleDate').textContent = today.toLocaleDateString('es-PR');
            
            // Configurar seg√∫n el modo
            if (mode === 'receive') {
                document.getElementById('moduleTitle').innerHTML = 'üì• Recibir Nueva Unidad';
                newEntry('recibo');
            } else if (mode === 'dispatch') {
                document.getElementById('moduleTitle').innerHTML = 'üì§ Despachar Unidad';
                newEntry('despacho');
            } else if (mode === 'emergency') {
                document.getElementById('moduleTitle').innerHTML = 'üö® Despacho de Emergencia';
                newEntry('emergencia');
            } else {
                document.getElementById('moduleTitle').innerHTML = 'üîÑ M√≥dulo Integral de Unidades';
            }
            
            updateEntryCounter();
        }

        function closeIntegratedModule() {
            document.getElementById('integratedModule').classList.remove('active');
            document.getElementById('mainPage').style.display = 'block';
            
            // Ocultar formulario si est√° abierto
            document.getElementById('entryForm').style.display = 'none';
            clearForm();
        }

        function newEntry(type = 'recibo') {
            document.getElementById('entryForm').style.display = 'block';
            document.getElementById('formTitle').textContent = 'Nueva Entrada';
            document.getElementById('saveBtn').style.display = 'inline-flex';
            
            // Configurar valores por defecto
            const today = new Date();
            document.getElementById('fecha').value = today.toISOString().split('T')[0];
            document.getElementById('tipoOperacion').value = type;
            document.getElementById('numeroUnidad').value = `BLD-${String(unitCounter++).padStart(3, '0')}`;
            
            const now = new Date().toLocaleTimeString('es-PR', {hour: '2-digit', minute: '2-digit'});
            if (type === 'recibo') {
                document.getElementById('timeReceived').value = now;
                document.getElementById('estadoUnidad').value = 'recibida';
            } else {
                document.getElementById('timeDispatched').value = now;
                document.getElementById('estadoUnidad').value = 'proceso';
            }
            
            updateFormMode();
            editingIndex = -1;
        }

        function updateFormMode() {
            const tipo = document.getElementById('tipoOperacion').value;
            const statusBadge = document.getElementById('entryStatus');
            
            // Ocultar todos los campos primero
            const allGroups = document.querySelectorAll('.form-group');
            allGroups.forEach(group => group.style.display = 'none');
            
            // Siempre mostrar campos b√°sicos
            document.getElementById('fecha').parentElement.style.display = 'flex';
            document.getElementById('tipoOperacion').parentElement.style.display = 'flex';
            document.getElementById('numeroUnidad').parentElement.style.display = 'flex';
            document.getElementById('estadoUnidad').parentElement.style.display = 'flex';
            
            if (tipo === 'recibo') {
                statusBadge.className = 'status-badge status-recibida';
                statusBadge.textContent = 'RECIBIDA';
                document.getElementById('estadoUnidad').value = 'recibida';
                
                // Mostrar campos espec√≠ficos para RECIBO
                document.getElementById('paciente').parentElement.style.display = 'flex';
                document.getElementById('record').parentElement.style.display = 'flex';
                document.getElementById('localizacion').parentElement.style.display = 'flex';
                document.getElementById('medico').parentElement.style.display = 'flex';
                document.getElementById('aboRhPaciente').parentElement.style.display = 'flex';
                document.getElementById('aboRhDonante').parentElement.style.display = 'flex';
                document.getElementById('fechaExpiracion').parentElement.style.display = 'flex';
                document.getElementById('componente').parentElement.style.display = 'flex';
                document.getElementById('volumen').parentElement.style.display = 'flex';
                document.getElementById('suplidor').parentElement.style.display = 'flex';
                document.getElementById('timeReceived').parentElement.style.display = 'flex';
                document.getElementById('transportTemp').parentElement.style.display = 'flex';
                document.getElementById('inspeccion').parentElement.style.display = 'flex';
                document.getElementById('personaNotificada').parentElement.style.display = 'flex';
                document.getElementById('horaNotificacion').parentElement.style.display = 'flex';
                document.getElementById('mt').parentElement.style.display = 'flex';
                
                // Cambiar label de timeReceived a "Time Arrived"
                document.querySelector('label[for="timeReceived"]').textContent = 'Time Arrived:';
                
            } else if (tipo === 'despacho') {
                statusBadge.className = 'status-badge status-proceso';
                statusBadge.textContent = 'EN PROCESO';
                document.getElementById('estadoUnidad').value = 'proceso';
                
                // Mostrar campos espec√≠ficos para DESPACHO
                document.getElementById('releasedBy').parentElement.style.display = 'flex';
                document.getElementById('receivedBy').parentElement.style.display = 'flex';
                document.getElementById('inspeccion').parentElement.style.display = 'flex';
                document.getElementById('timeDispatched').parentElement.style.display = 'flex';
                document.getElementById('returned').parentElement.style.display = 'flex';
                document.getElementById('comentarios').parentElement.style.display = 'flex';
                
                // Cambiar label de timeDispatched a "Hora"
                document.querySelector('label[for="timeDispatched"]').textContent = 'Hora:';
                
            } else if (tipo === 'emergencia') {
                statusBadge.className = 'status-badge status-despachada';
                statusBadge.textContent = 'EMERGENCIA';
                document.getElementById('estadoUnidad').value = 'despachada';
                
                // Mostrar TODOS los campos para EMERGENCIA
                allGroups.forEach(group => group.style.display = 'flex');
                
                // Restaurar labels originales
                document.querySelector('label[for="timeReceived"]').textContent = 'Hora Recibida:';
                document.querySelector('label[for="timeDispatched"]').textContent = 'Hora Despachada:';
            }
            
            // Siempre mostrar los botones de acci√≥n
            document.querySelector('.form-actions').style.display = 'flex';
        }

        function saveEntry() {
            // Validar campos obligatorios
            if (!document.getElementById('fecha').value || !document.getElementById('numeroUnidad').value) {
                showNotification('‚ö†Ô∏è Por favor complete los campos obligatorios', 'warning');
                return;
            }

            const entryData = collectFormData();
            
            if (editingIndex >= 0) {
                // Actualizar entrada existente
                currentEntries[editingIndex] = entryData;
                showNotification('‚úÖ Entrada actualizada exitosamente', 'success');
            } else {
                // Agregar nueva entrada
                currentEntries.unshift(entryData);
                showNotification('‚úÖ Nueva entrada guardada exitosamente', 'success');
            }
            
            updateTable();
            updateSystemStats();
            clearForm();
            document.getElementById('entryForm').style.display = 'none';
            document.getElementById('saveBtn').style.display = 'none';
        }

        function saveAndContinue() {
            saveEntry();
            setTimeout(() => {
                newEntry(document.getElementById('tipoOperacion').value);
            }, 500);
        }

        function collectFormData() {
            return {
                id: editingIndex >= 0 ? currentEntries[editingIndex].id : `BLD-${Date.now()}`,
                fecha: document.getElementById('fecha').value,
                numeroUnidad: document.getElementById('numeroUnidad').value,
                tipoOperacion: document.getElementById('tipoOperacion').value,
                estadoUnidad: document.getElementById('estadoUnidad').value,
                paciente: document.getElementById('paciente').value,
                record: document.getElementById('record').value,
                localizacion: document.getElementById('localizacion').value,
                medico: document.getElementById('medico').value,
                aboRhPaciente: document.getElementById('aboRhPaciente').value,
                aboRhDonante: document.getElementById('aboRhDonante').value,
                componente: document.getElementById('componente').value,
                volumen: document.getElementById('volumen').value,
                suplidor: document.getElementById('suplidor').value,
                fechaExpiracion: document.getElementById('fechaExpiracion').value,
                transportTemp: document.getElementById('transportTemp').value,
                timeReceived: document.getElementById('timeReceived').value,
                timeDispatched: document.getElementById('timeDispatched').value,
                inspeccion: document.getElementById('inspeccion').value,
                returned: document.getElementById('returned').value,
                mt: document.getElementById('mt').value,
                releasedBy: document.getElementById('releasedBy').value,
                receivedBy: document.getElementById('receivedBy').value,
                personaNotificada: document.getElementById('personaNotificada').value,
                horaNotificacion: document.getElementById('horaNotificacion').value,
                comentarios: document.getElementById('comentarios').value,
                timestamp: new Date().toISOString()
            };
        }

        function clearForm() {
            document.getElementById('entryForm').querySelectorAll('input, select, textarea').forEach(input => {
                if (input.id !== 'fecha' && input.type !== 'date') {
                    input.value = '';
                }
            });
            editingIndex = -1;
        }

        function cancelEntry() {
            if (confirm('¬øEst√° seguro que desea cancelar? Los cambios no guardados se perder√°n.')) {
                clearForm();
                document.getElementById('entryForm').style.display = 'none';
                document.getElementById('saveBtn').style.display = 'none';
            }
        }

        function editEntry(index) {
            const entry = currentEntries[index];
            if (!entry) return;
            
            editingIndex = index;
            document.getElementById('entryForm').style.display = 'block';
            document.getElementById('formTitle').textContent = `Editando: ${entry.numeroUnidad}`;
            document.getElementById('saveBtn').style.display = 'inline-flex';
            
            // Llenar formulario con datos existentes
            Object.keys(entry).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    element.value = entry[key] || '';
                }
            });
            
            updateFormMode();
        }

        function duplicateEntry(index) {
            const entry = {...currentEntries[index]};
            entry.id = `BLD-${Date.now()}`;
            entry.numeroUnidad = `BLD-${String(unitCounter++).padStart(3, '0')}`;
            entry.timestamp = new Date().toISOString();
            
            currentEntries.unshift(entry);
            updateTable();
            showNotification('üìã Entrada duplicada exitosamente', 'success');
        }

        function deleteEntry(index) {
            const entry = currentEntries[index];
            if (confirm(`¬øEst√° seguro que desea eliminar la entrada ${entry.numeroUnidad}?\n\nEsta acci√≥n no se puede deshacer.`)) {
                currentEntries.splice(index, 1);
                updateTable();
                showNotification('üóëÔ∏è Entrada eliminada', 'success');
            }
        }

        function updateTable() {
            const tbody = document.getElementById('integratedTableBody');
            tbody.innerHTML = '';
            
            currentEntries.forEach((entry, index) => {
                const row = tbody.insertRow();
                row.setAttribute('data-status', entry.estadoUnidad);
                
                const statusClass = `status-${entry.estadoUnidad}`;
                const statusText = {
                    'recibida': 'RECIBIDA',
                    'proceso': 'PROCESO',
                    'despachada': 'DESPACHADA',
                    'devuelta': 'DEVUELTA'
                };
                
                row.innerHTML = `
                    <td><span class="status-badge ${statusClass}">${statusText[entry.estadoUnidad] || 'N/A'}</span></td>
                    <td>${entry.fecha || '-'}</td>
                    <td><strong>${entry.numeroUnidad || '-'}</strong></td>
                    <td>${entry.paciente || '-'}</td>
                    <td>${entry.record || '-'}</td>
                    <td>${entry.localizacion || '-'}</td>
                    <td>${entry.medico || '-'}</td>
                    <td>${entry.aboRhPaciente || '-'}</td>
                    <td>${entry.aboRhDonante || '-'}</td>
                    <td>${entry.componente || '-'}</td>
                    <td>${entry.volumen ? entry.volumen + 'ml' : '-'}</td>
                    <td>${entry.fechaExpiracion || '-'}</td>
                    <td>${entry.suplidor || '-'}</td>
                    <td>${entry.timeReceived || '-'}</td>
                    <td>${entry.timeDispatched || '-'}</td>
                    <td>${entry.transportTemp ? entry.transportTemp + '¬∞C' : '-'}</td>
                    <td>${entry.inspeccion || '-'}</td>
                    <td>${entry.personaNotificada || '-'}</td>
                    <td>${entry.horaNotificacion || '-'}</td>
                    <td>${entry.mt || '-'}</td>
                    <td>${entry.releasedBy || '-'}</td>
                    <td>${entry.receivedBy || '-'}</td>
                    <td>${entry.returned || 'No'}</td>
                    <td>${entry.comentarios || '-'}</td>
                    <td>
                        <div class="row-actions">
                            <button class="action-btn btn-edit" onclick="editEntry(${index})" title="Editar">‚úèÔ∏è</button>
                            <button class="action-btn btn-duplicate" onclick="duplicateEntry(${index})" title="Duplicar">üìã</button>
                            <button class="action-btn btn-delete" onclick="deleteEntry(${index})" title="Eliminar">üóëÔ∏è</button>
                        </div>
                    </td>
                `;
            });
            
            updateEntryCounter();
        }

        function filterByStatus(status) {
            document.querySelectorAll('.status-filter').forEach(filter => {
                filter.classList.remove('active');
            });
            
            document.querySelector(`[data-status="${status}"]`).classList.add('active');
            
            const rows = document.querySelectorAll('#integratedTableBody tr');
            rows.forEach(row => {
                if (status === 'all') {
                    row.style.display = '';
                } else {
                    row.style.display = row.getAttribute('data-status') === status ? '' : 'none';
                }
            });
        }

        function searchEntries(query) {
            const rows = document.querySelectorAll('#integratedTableBody tr');
            const searchTerm = query.toLowerCase();
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        function updateEntryCounter() {
            document.getElementById('totalEntries').textContent = `Total: ${currentEntries.length} entradas`;
        }

        function printModule() {
            window.print();
        }

        function exportToCSV() {
            if (currentEntries.length === 0) {
                showNotification('‚ö†Ô∏è No hay datos para exportar', 'warning');
                return;
            }
            
            const headers = [
                'Estado', 'Fecha', 'N¬∞ Unidad', 'Paciente', 'Record', 'Localizaci√≥n', 'M√©dico',
                'ABO/Rh Paciente', 'ABO/Rh Donante', 'Componente', 'Volumen',
                'Fecha Exp.', 'Suplidor', 'H. Recibida', 'H. Despachada', 'Temp. Transport',
                'Inspecci√≥n', 'Persona Notificada', 'Hora Notif.', 'MT', 'Released by', 'Received by', 'Devuelta', 'Comentarios'
            ];
            
            const csvContent = [
                headers.join(','),
                ...currentEntries.map(entry => [
                    entry.estadoUnidad, entry.fecha, entry.numeroUnidad, entry.paciente,
                    entry.record, entry.localizacion, entry.medico, entry.aboRhPaciente,
                    entry.aboRhDonante, entry.componente, entry.volumen,
                    entry.fechaExpiracion, entry.suplidor, entry.timeReceived,
                    entry.timeDispatched, entry.transportTemp, entry.inspeccion,
                    entry.personaNotificada, entry.horaNotificacion, entry.mt, entry.releasedBy, entry.receivedBy, entry.returned, entry.comentarios
                ].map(field => `"${field || ''}"`).join(','))
            ].join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `bludee-registro-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
            
            showNotification('üìä Datos exportados exitosamente', 'success');
        }

        // Sistema de notificaciones
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // M√≥dulos en desarrollo (mantener funciones existentes)
        function showTransfusionModule() {
            alert('M√≥dulo de Transfusiones\n\nüíâ Caracter√≠sticas:\n‚Ä¢ Registro en tiempo real\n‚Ä¢ Monitoreo de reacciones\n‚Ä¢ Control de vol√∫menes\n‚Ä¢ Documentaci√≥n completa\n\nüöß En desarrollo...');
        }

        function showStatsModule() {
            alert('M√≥dulo de Estad√≠sticas\n\nüìà Caracter√≠sticas:\n‚Ä¢ Dashboards interactivos\n‚Ä¢ An√°lisis de tendencias\n‚Ä¢ M√©tricas de rendimiento\n‚Ä¢ Exportaci√≥n de datos\n\nüöß En desarrollo...');
        }

        function showQualityModule() {
            alert('M√≥dulo de Calidad\n\nüéØ Caracter√≠sticas:\n‚Ä¢ Indicadores KPI\n‚Ä¢ Control de procesos\n‚Ä¢ Auditor√≠as internas\n‚Ä¢ Mejora continua\n\nüöß En desarrollo...');
        }

        function showPermissionsModule() {
            alert('M√≥dulo de Permisos\n\nüîê Caracter√≠sticas:\n‚Ä¢ Gesti√≥n de roles\n‚Ä¢ Control de acceso\n‚Ä¢ Permisos granulares\n‚Ä¢ Auditor√≠a de seguridad\n\nüöß En desarrollo...');
        }

        function showConfigModule() {
            alert('M√≥dulo de Configuraci√≥n\n\n‚öôÔ∏è Caracter√≠sticas:\n‚Ä¢ Configuraci√≥n del sistema\n‚Ä¢ Par√°metros de laboratorio\n‚Ä¢ Preferencias de usuario\n‚Ä¢ Backup autom√°tico\n\nüöß En desarrollo...');
        }

        function showBackupModule() {
            alert('M√≥dulo de Respaldos\n\nüíæ Caracter√≠sticas:\n‚Ä¢ Backup autom√°tico\n‚Ä¢ Restauraci√≥n de datos\n‚Ä¢ Versionado de archivos\n‚Ä¢ Monitoreo de integridad\n\nüöß En desarrollo...');
        }

        function showMaintenanceModule() {
            alert('M√≥dulo de Mantenimiento\n\nüîß Caracter√≠sticas:\n‚Ä¢ Mantenimiento preventivo\n‚Ä¢ Calibraci√≥n de equipos\n‚Ä¢ Registro de incidencias\n‚Ä¢ Programaci√≥n de tareas\n\nüöß En desarrollo...');
        }

        function showHelpModule() {
            alert('M√≥dulo de Ayuda\n\n‚ùì Caracter√≠sticas:\n‚Ä¢ Manual de usuario\n‚Ä¢ Tutoriales interactivos\n‚Ä¢ FAQ del sistema\n‚Ä¢ Soporte t√©cnico\n\nüöß En desarrollo...');
        }

        function showTrainingModule() {
            alert('M√≥dulo de Capacitaci√≥n\n\nüìö Caracter√≠sticas:\n‚Ä¢ Cursos online\n‚Ä¢ Certificaciones\n‚Ä¢ Evaluaciones\n‚Ä¢ Progreso de aprendizaje\n\nüöß En desarrollo...');
        }

        function logout() {
            if (confirm('¬øEst√° seguro que desea cerrar sesi√≥n?')) {
                alert('Cerrando sesi√≥n...\n\nGracias por usar BLUDEE.');
            }
        }

        function loadSystemStats() {
            const stats = {
                available: Math.floor(Math.random() * 20) + 35,
                pending: currentEntries.filter(e => e.estadoUnidad === 'proceso').length,
                critical: Math.floor(Math.random() * 3),
                users: Math.floor(Math.random() * 5) + 6
            };

            document.getElementById('available-units').textContent = stats.available;
            document.getElementById('pending-requests').textContent = stats.pending;
            document.getElementById('critical-alerts').textContent = stats.critical;
            document.getElementById('active-users').textContent = stats.users;

            if (stats.critical > 0) {
                showCriticalAlerts(stats);
            }
        }

        function updateSystemStats() {
            const pending = currentEntries.filter(e => e.estadoUnidad === 'proceso').length;
            document.getElementById('pending-requests').textContent = pending;
        }

        function showCriticalAlerts(stats) {
            const alertsBanner = document.getElementById('alerts-banner');
            const alertsList = document.getElementById('alerts-list');
            
            let alerts = [];
            
            if (stats.critical > 0) {
                alerts.push(`‚Ä¢ ${stats.critical} unidad(es) pr√≥xima(s) a vencer en las pr√≥ximas 24 horas`);
            }
            
            if (stats.available < 40) {
                alerts.push('‚Ä¢ Stock bajo en algunos tipos de sangre');
            }
            
            if (alerts.length > 0) {
                alertsList.innerHTML = alerts.join('<br>');
                alertsBanner.classList.add('show');
            }
        }

        function checkAuthentication() {
            const isAuthenticated = true;
            
            if (!isAuthenticated) {
                window.location.href = 'login.html';
                return;
            }
            
            document.getElementById('username').textContent = currentUser.name;
            document.getElementById('user-role').textContent = currentUser.role;
            document.getElementById('user-avatar').textContent = currentUser.initials;
        }

        // Atajos de teclado mejorados
        document.addEventListener('keydown', function(event) {
            if (event.ctrlKey) {
                switch(event.key) {
                    case 'n':
                        event.preventDefault();
                        if (document.getElementById('integratedModule').classList.contains('active')) {
                            newEntry();
                        } else {
                            openIntegratedModule('receive');
                        }
                        break;
                    case 's':
                        event.preventDefault();
                        if (document.getElementById('entryForm').style.display !== 'none') {
                            saveEntry();
                        }
                        break;
                    case 'r':
                        event.preventDefault();
                        openIntegratedModule('tracking');
                        break;
                    case 'e':
                        event.preventDefault();
                        openIntegratedModule('emergency');
                        break;
                }
            }
            
            if (event.key === 'Escape') {
                if (document.getElementById('integratedModule').classList.contains('active')) {
                    if (document.getElementById('entryForm').style.display !== 'none') {
                        cancelEntry();
                    } else {
                        closeIntegratedModule();
                    }
                }
            }
        });

        // Inicializaci√≥n mejorada
        document.addEventListener('DOMContentLoaded', function() {
            checkAuthentication();
            updateDateTime();
            loadSystemStats();
            
            setInterval(loadSystemStats, 30000);
            setInterval(updateDateTime, 1000);
            
            // Cargar datos de ejemplo adicionales
            currentEntries = [
                {
                    id: 'BLD-001',
                    fecha: '2024-09-17',
                    numeroUnidad: 'BLD-001',
                    estadoUnidad: 'despachada',
                    paciente: 'Mar√≠a Gonz√°lez',
                    record: 'MG-001',
                    localizacion: 'Emergencia',
                    medico: 'Dr. Rodr√≠guez',
                    aboRhPaciente: 'O+',
                    aboRhDonante: 'O+',
                    componente: 'PRBC Completa',
                    volumen: '250',
                    fechaExpiracion: '2024-10-15',
                    suplidor: 'Cruz Roja PR',
                    timeReceived: '08:30',
                    timeDispatched: '09:00',
                    transportTemp: '4.2',
                    inspeccion: 'Aprobada',
                    returned: 'No',
                    mt: 'MT-Jos√©',
                    releasedBy: 'Lab-Ana',
                    receivedBy: 'Enf-Luis',
                    comentarios: 'Transfusi√≥n exitosa',
                    timestamp: '2024-09-17T08:30:00.000Z'
                }
            ];
            
            unitCounter = 2; // Siguiente n√∫mero disponible
            
            showNotification('üöÄ Sistema BLUDEE Integral iniciado correctamente', 'success');
        });
    </script>
</body>
</html>

   
